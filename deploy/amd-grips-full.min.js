/* grips (c) 2012 Kyle Simpson | http://getify.mit-license.org/ */
;(function(){Object.keys||(Object.keys=function(t){var n,r=[];for(n in t)t.hasOwnProperty(n)&&r.push(n);return r}),function(t){function r(){function e(){}function i(){var e=t.grips;return t.grips=n,e}function s(e){e in g||(g[e]={collection:"",extend:null,partials:{}})}function o(e,t){s(e),g[e].extend=t}function u(t){var n,r,i;if(typeof t=="object"){if(t===null)return t;if(Object.prototype.toString.call(t)==="[object Array]"){r=[];for(n=0;n<t.length;n++)typeof t[n]=="object"?i=u(t[n]):i=t[n],r.push(i)}else{t instanceof e?r=new e:r={};for(n in t)t.hasOwnProperty(n)&&(typeof (t[n]==="object")?i=u(t[n]):i=t[n],r[n]=i)}}else r=t;return r}function a(e,t){var n=t.match(/^(.+)#/);n&&(n=n[1]);if(!n)throw y;s(n),g[n].partials[t.replace(/^.*#/,"#")]=function(){var n;try{n=e.apply(m,arguments)}catch(r){throw y}if(n instanceof Error)throw n;return n}}function f(e,t){var n="",r,i;t=t!==!1;if(Object.prototype.toString.call(e)==="[object Array]")for(r=0;r<e.length;r++)n+=c(e[r],null,t);else if(typeof e=="object")for(i in e)e.hasOwnProperty(i)&&(n+=c(e[i],i,t));return n}function l(e,t){if(!t)throw y;return c(e,t,!1)}function c(e,t,n){n=n!==!1;try{if(m.tokenizer.process(e,t))return m.parser.end(),m.generator.process(n)}catch(r){throw y}return!1}function h(e){var n,r;"document"in t?(n=document.createElement("script"),n.text=e,r=document.getElementsByTagName("script")[0],r.parentNode.insertBefore(n,r)):(n=new Function(e),n.call(t))}function p(e,t){s(e),h(t)}function d(e,t,n){if(!e)return"";var r,i,s,o,u=[],a=!1,f=!1;r=e.match(/^(.+)#/),r&&(r=r[1],a=!0);if(!a&&b.length>0)r=b[b.length-1];else if(!a||b.length>0&&b[b.length-1]===r){if(!r)throw y}else b.push(r),f=!0;if(r in g){e=e.replace(/^(.+)#/,"#"),o=r+e,w.push(o);for(s=0;s<w.length-1;s++)if(w[s]===o)throw y;a?u.push(r):u=u.concat(b);if(!(e in g[r].partials)&&g[r].extend){o=g[r].extend;while(o&&o in g)u.push(o),o=g[o].extend}for(s=0;s<u.length;s++)if(e in g[u[s]].partials){i=g[u[s]].partials[e](t,n);break}}if(i)return w.pop(),f&&b.pop(),i;throw y}function v(e,t){return typeof e=="string"&&(t.html&&/[&<>"]/.test(e)&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/,"&quot;")),t.string&&(e=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\t/g,"\\t")),t.url&&(e=encodeURIComponent(e))),e}var m,g={},y=new Error("Unknown error"),b=[],w=[];return m={extend:o,cloneObj:u,definePartial:a,strEscapes:v,compile:f,compileChunk:l,compileCollection:c,initialize:h,initializeCollection:p,render:d,noConflict:i,sandbox:r,RangeLiteralHash:e,collections:g},m}var n=t.grips;t.grips=r()}(this),function(t){function n(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function r(){var e;do e=Math.floor(Math.random()*1e9);while(e in o);return e}function i(e,i){function m(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===w){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==w){n=i-1;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return e}function C(e){for(var t=0;t<e.length;t++)e[t].type===w&&(e[t].val=e[t].val.replace(/\\\\/g,"\\"));return e}function k(){var r,o;F&&(q=new n({type:null,val:F}),F.match(/^\s+$/)?q.type=E:q.type=w,s.push(q));if(B){o=e.substring(0,D-B[0].length);if(!!o&&!o.match(x)){s.push(new n({type:w,val:B[0]}));return}if(B[0]==="{$}")s.push(new n({type:l,val:B[0]}));else{if(B[0]!=="{$")return N;q=new n({type:u,val:B[0]}),s.push(q);if(!(D<e.length-1&&(B=e.substr(D).match(/^(?:(?:~|escape\s+)[hsuHSU]+|[~:+=*\/%]|(?:(?:define|extend|insert|print|partial|loop|comment|raw|escape)\b))/))))return N;s.push(new n({type:c,val:B[0]})),D+=B[0].length}}s=s.concat(r=C(m(s.splice(H-s.length)))),I=t.parser.nodify(r,i),H=s.length}function L(){var e,r;if(F){if(r=F.match(/[^a-z0-9_$\s]/i))return N;s.push(new n({type:w,val:F}))}if(B)if(B[0]==="$}")s.push(new n({type:a,val:B[0]}));else if(B[0]==="}")s.push(new n({type:f,val:B[0]}));else{if(B[0].match(/^\s+$/)){s.push(new n({type:E,val:B[0]}));return}if(B[0].match(/^["']$/))q=new n({type:0,val:B[0]}),B[0]==='"'?q.type=y:q.type=g,s.push(q),T[t.parser.LITERAL]=new RegExp(B[0],"g"),T[t.parser.LITERAL].lastIndex=0;else if(B[0].match(/^(?:\.\.)|[:=?\(\)\[\],\-.!]$/))s.push(new n({type:b,val:B[0]}));else if(B[0]==="|")s.push(new n({type:d,val:B[0]}));else if(B[0]==="@")s.push(new n({type:v,val:B[0]}));else{if(!B[0].match(/^~[hsuHSU]*$/)){s.push(new n({type:w,val:B[0]}));return}s.push(new n({type:S,val:B[0]}))}}s=s.concat(e=C(m(s.splice(H-s.length)))),I=t.parser.nodify(e,i),H=s.length}function A(){var e,r;s[s.length-1].type!==w&&s.push(new n({type:w,val:""})),F&&(s[s.length-1].val+=F),B&&(r=s[s.length-1].val,!r||r.match(x)?(s.push(new n({type:p,val:B[0]})),s=s.concat(e=C(m(s.splice(H-s.length)))),I=t.parser.nodify(e,i),H=s.length):(r&&!r.match(x)&&(s[s.length-1].val=s[s.length-1].val.substr(0,s[s.length-1].val.length-1)),s[s.length-1].val+=B[0]))}function O(){var e,r;if(B){r=s[s.length-1].val;if(!r||r.match(x))s.push(new n({type:h,val:B[0]})),s=s.concat(e=C(m(s.splice(H-s.length)))),I=t.parser.nodify(e,i),H=s.length}}function M(){var e,r;s[s.length-1].type!==w&&s.push(new n({type:w,val:""})),F&&(s[s.length-1].val+=F),B&&(r=s[s.length-1].val,!r||r.match(x)?(s.push(new n({type:B[0]==='"'?y:g,val:B[0]})),s=s.concat(e=C(m(s.splice(H-s.length)))),I=t.parser.nodify(e,i),H=s.length,T[t.parser.STRING_LITERAL]=null):(r&&!r.match(x)&&(s[s.length-1].val=s[s.length-1].val.substr(0,s[s.length-1].val.length-1)),s[s.length-1].val+=B[0]))}var _,D=0,P=0,H=s.length,B,j,F,I,q,R,U=[k,L,A,O,M];i||(i=r(),o[i]=!0,i="chunk_"+i);while((!I||I===!0)&&D<e.length){F="",I=null,j=t.parser.state;if(j===t.parser.INVALID)break;_=T[j];if(!_){I=N;break}F="",_.lastIndex=D,B=_.exec(e);if(B)P=D,D=_.lastIndex,P<D-B[0].length&&(F=e.substring(P,D-B[0].length));else{P=D,D=e.length,F=e.substr(P);if(!F)break}R=U[j]();if(R&&R!==!0)break;if(I&&I!==!0)break}if(R instanceof Error)throw R;if(I instanceof Error)throw I;return!0}var s=[],o={},u=0,a=1,f=2,l=3,c=4,h=5,p=6,d=7,v=8,m=9,g=10,y=11,b=12,w=13,E=14,S=15,x=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,T=[/\{\$\}|\{\$/g,/\$\}|\}|(?:\.\.)|(?:~[hsuHSU]*)|["':=@\|?\(\)\[\],\-.!]|\s+/g,/%\$\}/g,/\/\$\}/g],N=new Error("Unknown error");t.tokenizer={OPEN:u,SIMPLE_CLOSE:a,BLOCK_HEAD_CLOSE:f,BLOCK_FOOTER:l,SIGNIFIER:c,COMMENT_CLOSE:h,RAW_CLOSE:p,PIPE:d,AT:v,STRING_LITERAL:m,SINGLE_QUOTE:g,DOUBLE_QUOTE:y,OPERATOR:b,GENERAL:w,WHITESPACE:E,TILDE:S,process:i,Token:n}}(this.grips),function(t){function n(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function r(e,r){function i(e){if(e.type===t.tokenizer.OPEN)l=new n({parent:null,type:null,token:e,def:[],children:[],complete:!1}),p?(l.parent=p,p.children.push(l)):(delete l.parent,h.push(l)),p=l,X.state=g;else if(e.type===t.tokenizer.GENERAL)l=new n({parent:null,type:S,token:e,val:e.val,complete:!0}),p?(l.parent=p,p.children.push(l)):(delete l.parent,h.push(l));else if(p&&e.type===t.tokenizer.WHITESPACE)l=new n({parent:p,type:S,token:e,val:e.val,complete:!0}),p.children.push(l);else if(e.type===t.tokenizer.BLOCK_FOOTER){if(!p||p.close_header!==t.tokenizer.BLOCK_HEAD_CLOSE)return X.state=E,V;p.complete=!0,p=p.parent}}function s(e){function i(){if(p.type===C||p.type===N||p.type===k){l=new n({parent:p,type:null,token:null,def:[]});if(!p.main_expr&&p.type===k)p.main_expr=l,l.type=M;else if(p.type===C||p.type===N){if(!!p.main_expr)return X.state=E,V;p.main_expr=l,l.type=M,p.type===N&&(l.collection_id=r)}else l.type=_;p.def.push(l),p=l}}if(e.type===t.tokenizer.SIGNIFIER){if(!p||p.type!=null)return X.state=E,V;e.val.match(/^(?:\:|define)$/)?p.type=T:e.val.match(/^(?:\+|extend)$/)?p.type=x:e.val.match(/^(?:\=|insert|print)$/)?p.type=C:e.val.match(/^partial$/)?p.type=N:e.val.match(/^(?:\*|loop)$/)?p.type=k:e.val.match(/^(?:\%|raw)$/)?p.type=L:e.val.match(/^(?:\/|comment)$/)?p.type=A:e.val.match(/^(?:escape|(?:~|escape\s+)[hsuHSU]*)$/)&&(p.type=W),p.type===x||p.type===C?(p.close_header=t.tokenizer.SIMPLE_CLOSE,delete p.children):p.type===N?p.close_header=t.tokenizer.SIMPLE_CLOSE:p.type===T||p.type===k?p.close_header=t.tokenizer.BLOCK_HEAD_CLOSE:p.type===W?(p.close_header=t.tokenizer.BLOCK_HEAD_CLOSE,p.escapes={},e.val.match(/(?:~.*|escape\s+.*)h/i)&&(p.escapes.html=!0),e.val.match(/(?:~.*|escape\s+.*)s/i)&&(p.escapes.string=!0),e.val.match(/(?:~.*|escape\s+.*)u/i)&&(p.escapes.url=!0),e.val.match(/\b[hsu]$/i)||(p.escapes.string=!0),delete p.def):p.type===L?(p.val="",X.state=y,delete p.def,delete p.children):p.type===A&&(p.val="",X.state=b,delete p.def,delete p.children);if(!p.parent&&p.type!==x&&p.type!==T&&p.type!==A||p.parent&&(p.type===x||p.type===T))return X.state=E,V}else if(e.type===t.tokenizer.WHITESPACE){if(p){if(p.type!==x&&p.type!==T&&p.type!==N&&p.type!==C&&p.type!==k&&p.type!==W&&p.type!==_&&p.type!==M)return X.state=E,V;p.def&&p.def.length>0&&p.def.push(new n({parent:p,type:R,token:e}))}}else if(e.type===t.tokenizer.AT){if(!p||p.type!==C||p.def.length!==0)return X.state=E,V;p.type=N}else if(e.type===t.tokenizer.TILDE){if(!p||p.type!==N&&p.type!==C||p.def.length!==0)return X.state=E,V;p.escapes={},e.val.match(/h/i)&&(p.escapes.html=!0),e.val.match(/s/i)&&(p.escapes.string=!0),e.val.match(/u/i)&&(p.escapes.url=!0),e.val.match(/[hsu]/i)||(p.escapes.string=!0)}else if(e.type===t.tokenizer.SINGLE_QUOTE||e.type===t.tokenizer.DOUBLE_QUOTE){if(!p||p.type!==x&&p.type!==T&&p.type!==N&&p.type!==_&&p.type!==M)return X.state=E,V;X.state=w,l=new n({parent:p,type:null,token:e,val:"",delimiter:e.val});if(p.type===T||p.type===x){if(!!p.id)return X.state=E,V;p.id=l,l.type=O,p.type===T&&(l.collection_id=r)}else if(p.type===N){if(!!p.main_expr)return X.state=E,V;p.main_expr=l,l.type=O,l.collection_id=r}else l.type=F;p.def.push(l),p=l}else if(e.type===t.tokenizer.OPERATOR){if(!p)return X.state=E,V;e.val.match(/[\(\[]/)&&i();if(p.type!==_&&p.type!==M)return X.state=E,V;p.token||(p.token=e);if(e.val==="-"&&p.def.length>0&&p.def[p.def.length-1].type!==R&&(p.def[p.def.length-1].type!==U||!p.def[p.def.length-1].val.match(/(?:\.\.)|\[/)))return V;p.def.push(new n({parent:p,type:U,token:e,val:e.val}))}else if(e.type===t.tokenizer.PIPE){if(!p)return X.state=E,V;if(p.type===_||p.type===M){if(p.def.length===0)return X.state=E,V;p=p.parent}if(!p.id&&(p.type===T||p.type===x))return X.state=E,V;if(!(p.type===T||p.type===k||p.type===N&&!p.context_expr))return X.state=E,V;l=new n({parent:p,type:_,token:null,def:[]}),p.type===N&&(p.context_expr=l),p.def.push(l),p=l}else if(e.type===t.tokenizer.SIMPLE_CLOSE){if(!p)return X.state=E,V;if(p.type===_||p.type===M)p=p.parent;if(!p.id&&p.type===x)return X.state=E,V;if(p.close_header!==t.tokenizer.SIMPLE_CLOSE)return X.state=E,V;p.type===N&&!p.context_expr&&(l=new n({parent:p,type:_,token:null,def:[]}),l.def.push(new n({parent:l,type:S,token:null,val:"$"})),p.context_expr=l,p.def.push(l)),p.complete=!0,X.state=m,p=p.parent}else if(e.type===t.tokenizer.BLOCK_HEAD_CLOSE){if(!p)return X.state=E,V;if(p.type===_||p.type===M)p=p.parent;if(!p.id&&p.type===T)return X.state=E,V;if(p.close_header!==t.tokenizer.BLOCK_HEAD_CLOSE)return X.state=E,V;X.state=m}else if(e.type===t.tokenizer.GENERAL){if(!p)return X.state=E,V;i();if(p.type!==_&&p.type!==M)return X.state=E,V;p.token||(p.token=e),e.val.match(/^\d+$/)&&p.def.length>0&&p.def[p.def.length-1].type===U&&p.def[p.def.length-1].val==="-"?p.def[p.def.length-1]=new n({parent:p,type:S,token:new t.tokenizer.Token({type:t.tokenizer.GENERAL,val:"-"+e.val}),val:"-"+e.val}):p.def.push(new n({parent:p,type:S,token:e,val:e.val}))}}function o(e){if(e.type===t.tokenizer.GENERAL)p.token.type!==t.tokenizer.GENERAL&&(p.token=e),p.val+=e.val;else{if(e.type!==t.tokenizer.RAW_CLOSE)return V;p.complete=!0,p=p.parent,X.state=m}}function u(e){e.type===t.tokenizer.COMMENT_CLOSE&&(p=p.parent,p?p.children.pop():h.pop(),X.state=m)}function a(e){if(e.type===t.tokenizer.GENERAL)p.token.type!==t.tokenizer.GENERAL&&(p.token=e),p.val+=e.val;else{if(e.type!==t.tokenizer.SINGLE_QUOTE&&e.type!==t.tokenizer.DOUBLE_QUOTE||p.delimiter!==e.val)return V;p=p.parent,X.state=g}}var f,l,c,v=[i,s,o,u,a];r!==d&&(d&&h.push(new n({type:z,close:d,complete:!0})),d=r,h.push(new n({type:z,start:r,complete:!0})));for(f=0;f<e.length;f++){if(X.state===E)return V;c=v[X.state](e[f]);if(c)return c}return!0}function i(){d&&h.push(new n({type:z,close:d,complete:!0})),d=null}function s(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===S){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==S){n--;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].token.val+=e[i].token.val,e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return o(e)}function o(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===R){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==R){n--;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].token.val+=e[i].token.val,e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return e}function u(e){var t=[],n=0,r=e.length-1;while(n<=r){e[n].type===R&&n++,e[r].type===R&&r--;if(!(n<r)||e[n].type!==R&&e[r].type!==R)break}return n<=r&&(t=e.slice(n,r+1)),t}function a(e){var t=[],n=0,r=e.length-1,i,s=0;while(n<r){e[n].type===R&&n++,e[r].type===R&&r--;if(n<r&&e[n].type!==R&&e[r].type!==R){if(e[n].type!==U||e[n].val!=="("||e[r].type!==U||e[r].val!==")")break;for(i=n+1;i<r;i++)if(e[i].type===U){e[i].val==="("?s++:e[i].val===")"&&s--;if(s<0)break}if(s!==0)break;n++,r--}}return n<=r&&(t=e.slice(n,r+1)),t}function f(e){for(var t=0;t<e.length;t++)e[t].type===U&&(e.splice(t,1),t--)}function l(e){function r(e){var t,n,r=[],i=!1;if(e.length<5)return!1;if(e[0].type!==U||e[0].val!=="[")return!1;r.push(e[0]);for(t=1;t<e.length;t++){n=e[t];if(n.type===R)continue;r.push(n);if(n.type===U){if(n.val==="]")break;if(!n.val.match(/(?:\.\.)|[\-,]/))return!1;n.val.match(/(?:\.\.)|,/)&&(i=!0)}}return r.length<5||!i?!1:r}function i(e){function t(e,t,r){var i,s;e=a(e),i=new n({parent:u,type:t,token:e[0].token,def:e}),E=r(i);if(E)return E;for(s=0;s<i.def.length;s++)i.def[s].parent=i;return i}var r,i,s=[],o,u,f,l,c;if(e.length>0){for(r=0;r<e.length;r++){i=e[r];if(i.type===U&&i.val.match(/[?:]/)){if(i.val==="?"){if(!!u)return!1;u=new n({parent:null,type:B,token:e[0].token,def:[]}),f=t(s,j,h);if(f instanceof Error)throw f;c=new n({parent:u,type:H,token:null,def:[]}),o=new n({parent:c,type:F,token:null,val:"",delimiter:'"'}),c.def.push(o),s=[]}else if(i.val===":"){if(!u||!!l)return!1;l=t(s,H,m);if(l instanceof Error)throw l;s=[]}}else s.push(i)}if(s.length>0){if(!u)return!1;if(!l){l=t(s,H,m);if(l instanceof Error)throw l}else{c=t(s,H,m);if(c instanceof Error)throw c}s=[]}if(f&&l)return u.def.push(f,l,c),u}}function c(e){var t;if((t=e.val.match(/#/g))&&t.length>1)return V;if(e.parent.type===T){if(!e.val)return V;if(t=e.val.match(/(#.*?)([^a-z0-9_\-$.]).*$/i))return V;if(!e.val.match(/^#/))return V;e.val=e.collection_id+e.val}else if(e.parent.type===x){if(t=e.val.match(/#/))return V}else if(e.parent.type===N){if(!e.val||!e.val.match(/#.+/))return V;if(t=e.val.match(/(#.*?)([^a-z0-9_\-$.]).*$/i))return V}}function h(e){function n(e){while(e.parent&&(e=e.parent))if(e.type===t.parser.TAG_LOOP)return!0;return!1}function r(e){while(e.parent&&(e=e.parent))if(e.type===t.parser.MAIN_REF_EXPR||e.type===t.parser.ASSIGNMENT_EXPR)return e.type===t.parser.MAIN_REF_EXPR;return!1}var i,s,o,u,a=[];if(!(e.def&&e.def.length>0))return V;for(i=0;i<e.def.length;i++){if(e.def[i].type===R)continue;o=u,u=e.def[i];if(u.type===U){if(!u.val.match(/[.!\[\]\(\)]/))return V;if(o)if(o.type===U){if(u.val==="("&&!o.val.match(/[!\(\[]/))return V;if(u.val==="!"&&!o.val.match(/[!\(]/))return V;if(u.val.match(/[.\[\]\)]/)&&!o.val.match(/[\]\)]/))return V}else{if(o.type===S&&!u.val.match(/[.\[\]\)]/))return V;if(o.type===F&&!u.val.match(/[\]\)]/))return V}else if(!u.val.match(/[!\(]/))return V;if(u.val.match(/[\[\(]/))a.push(u.val);else if(u.val.match(/[\]\)]/)){if(!(a.length>0&&(a[a.length-1]==="["&&u.val==="]"||a[a.length-1]==="("&&u.val===")")))return V;a.pop()}}else if(u.type===S){if(u.val.match(/^\d/)){if(!u.val.match(/^\d+$/))return V;if(o&&(o.type!==U||!o.val.match(/[\(\[]/)))return V}s=r(u);if(e.def.length===1&&u.val==="_"&&!s&&u.parent.parent.context_expr!==u.parent)return V;if(u.val==="_"&&!(s&&n(u.parent.parent)||!s&&n(u)))return V;if(o){if(o.type===S)return V;if(o.type===U&&!o.val.match(/[.!\(\[]/))return V}}else if(u.type===F&&o&&(o.type!==U||!o.val.match(/[\[\(]/)))return V}if(a.length>0)return V}function p(e){if(!e.def||e.def.length!==5)return V;if(e.def[1].type!==S||!e.def[1].val.match(/^-?\d+$/))return V;if(e.def[3].type!==S||!e.def[3].val.match(/^-?\d+$/))return V;if(e.def[2].type!==U||e.def[2].val!=="..")return V}function d(e){var t,n,r;if(!(e.def&&e.def.length>=5))return V;for(t=1;t<e.def.length-1;t++){n=r,r=e.def[t];if(r.type===F){if(n&&(n.type!==U||n.val!==","))return V}else{if(r.type!==U||r.val!==",")return V;if(!n||n.type!==F)return V}}if(e.def[e.def.length-2].type!==F)return V}function v(e){var t,s,o,l,c,h,v=[],y,b;if(!(e.def&&e.def.length>0))return V;for(t=0;t<e.def.length;t++){if(e.def[t].type===R)continue;o=l,l=e.def[t];if(!!y){c=a(e.def.slice(t));if(c.length===0)return V;b=new n({parent:e,type:H,token:c[0].token,def:[]}),h=i(c);if(!h){b.def=c,E=m(b);if(E)return E}else b.def=[h];for(s=0;s<b.def.length;s++)b.def[s].parent=b;break}if(l.type===U)if(l.val==="="){y=new n({parent:e,type:P,token:v[0].token,def:v});if(!v[0]||v[0].type!==P||!v[1]||v[1].type!==q&&v[1].type!==I){E=g(y);if(E)return E}for(s=0;s<y.def.length;s++)y.def[s].parent=y;v=[]}else if(l.val==="["){c=r(e.def.slice(t));if(c){h=new n({parent:null,type:P,token:e.def[0].token,def:e.def.slice(0,t)}),E=g(h),E||(v=[h],h=new n({parent:null,type:I,token:l.token,def:c}),E=p(h),E&&(h.type=q,E=d(h)),E?E=V:(v.push(h),t+=c.length-1,f(h.def)));if(E)return E}else v.push(l)}else{if(!o||!l.val.match(/[.\[\]]/))return V;v.push(l)}else v.push(l)}if(!y||!b)return V;y.def=u(y.def),b.def=u(b.def),e.def=[y,b],e.type=D}function m(e){var t,n,r,i=!1;if(!(e.def&&e.def.length>0))return V;for(t=0;t<e.def.length;t++){n=e.def[t];if(n.type===U){if(n.val==="!")return V}else if(n.type===S)if(!n.val.match(/^\d+$/))i=!0;else if(!i)return V}r=h(e);if(r)return r}function g(e){var t,n,r,i;if(!(e.def&&e.def.length>0))return V;for(t=0;t<e.def.length;t++){if(e.def[t].type===R)continue;n=r,r=e.def[t];if(r.type===F&&(!n||n.type!==U||n.val!=="["))return V}i=m(e);if(i)return i}var y,b,w,E,A;if(e.type===x){if(!e.id||!(y=l(e.id)))throw V;e.id=y;if(e.def&&e.def.length){e.def[0]=e.id;if(e.def.length>1){for(A=1;A<e.def.length;A++)if(e.def[A].type!==R)throw V;e.def=[e.id]}}return e}if(e.type===T){if(!e.id||!(y=l(e.id)))throw V;e.id=y;if(e.def&&e.def.length){y=[e.id],w=u(e.def.slice(1));for(A=0;A<w.length;A++)b=l(w[A]),b&&y.push(b);e.def=y}if(e.children&&e.children.length){e.children=s(e.children),y=[];for(A=0;A<e.children.length;A++)b=l(e.children[A]),b&&y.push(b);e.children=s(y)}return e}if(e.type===k){if(!e.main_expr||!(y=l(e.main_expr)))throw V;e.main_expr=y;if(e.def&&e.def.length){y=[e.main_expr],w=u(e.def.slice(1));for(A=0;A<w.length;A++)b=l(w[A]),b&&y.push(b);e.def=y}if(e.children&&e.children.length){e.children=s(e.children),y=[];for(A=0;A<e.children.length;A++)b=l(e.children[A]),b&&y.push(b);e.children=s(y)}return e}if(e.type===C){if(!e.main_expr||!(y=l(e.main_expr)))throw V;e.main_expr=y;if(e.def&&e.def.length){if(e.def.length>1)for(A=1;A<e.def.length;A++)if(e.def[A].type!==R)throw V;e.def=[e.main_expr]}return e}if(e.type===N){if(!e.main_expr||!(y=l(e.main_expr)))throw V;e.main_expr=y,e.context_expr.type=P,e.context_expr.def=u(e.context_expr.def),E=g(e.context_expr);if(E)throw E;return e.def=[e.main_expr,e.context_expr],e}if(e.type===L)return e.type=S,e;if(e.type===O){if(E=c(e))throw E;return e}if(e.type===_){if(!e.def||!e.def.length)throw V;e.def=o(e.def),e.def=u(e.def),E=v(e);if(E)throw E;return e}if(e.type===M){if(!e.def||!e.def.length)throw V;y=[];for(A=0;A<e.def.length;A++)e.def[A].type!==R&&y.push(e.def[A]);e.def=a(y);if((y=r(e.def))&&y.length===e.def.length){y=new n({parent:e,type:null,token:e.token,def:y});for(A=0;A<y.def.length;A++)y.def[A].parent=y;E=p(e),E?(E=d(e),E||(y.type=q)):y.type=I;if(E)throw V;f(y.def),e.def=[y]}else e.parent.type===C||e.parent.type===k?E=g(e):e.parent.type===N&&(E=m(e));if(E)throw E;return e}if(e.type!==S)return e;if(!e.parent&&e.token.type!==t.tokenizer.WHITESPACE)throw V;if(e.val!=="")return e}function c(){var e;while(v<h.length&&!e&&h[v].complete)e=l(h[v++]);return e}var h=[],p,d="",v=0,m=0,g=1,y=2,b=3,w=4,E=5,S=0,x=1,T=2,N=3,C=4,k=5,L=6,A=7,O=8,M=9,_=10,D=11,P=12,H=13,B=14,j=15,F=16,I=17,q=18,R=19,U=20,z=21,W=22,X,V=new Error("Unknown error");X={OUTSIDE:m,INSIDE:g,RAW:y,COMMENT:b,LITERAL:w,INVALID:E,TEXT:S,TAG_EXTEND:x,TAG_DEFINE:T,TAG_INCL_TMPL:N,TAG_INCL_VAR:C,TAG_LOOP:k,TAG_RAW:L,TAG_COMMENT:A,ID:O,MAIN_REF_EXPR:M,GENERAL_EXPR:_,ASSIGNMENT_EXPR:D,REF_EXPR:P,VAL_EXPR:H,CONDITIONAL_EXPR:B,BOOLEAN_EXPR:j,STRING_LITERAL:F,RANGE_LITERAL:I,SET_LITERAL:q,WHITESPACE:R,OPERATOR:U,COLLECTION_MARKER:z,TAG_ESCAPE:W,state:m,nodify:r,end:i,parseNextNode:c,Node:n},t.parser=X}(this.grips),function(t){function n(e){return e.replace(/\\([\s\S])|(")/g,"\\$1$2")}function r(e){return e.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}function i(e){return e.replace(/\\(?!\\*\")/g,"\\\\")}function s(e){var t="";return t+="(function(G){",t+="function __sort_fn__(a,b){ return a-b; }",t+="var partial = G.definePartial, clone = G.cloneObj, extend = G.extend, esc = G.strEscapes,",t+='unerr = new Error("Unknown error"),',t+="RLH = G.RangeLiteralHash,",t+='cID = "'+e.start+'";',t}function o(){return"})(this.grips);"}function u(e){return c(e.def[0])+" ? "+c(e.def[1])+" : "+c(e.def[2])}function a(e){return e.delimiter+e.val+e.delimiter}function f(e){var t="";return t+="for (i="+e.def[0].val+"; i",e.def[0].val<=e.def[1].val?t+="<="+e.def[1].val+"; i++) {":t+=">="+e.def[1].val+"; i--) {",t}function l(e){var t,n="",r,i;i="";for(t=0;t<e.def.length;t++)r=e.def[t],i+=(i!==""?",":"")+a(r);return n+="var _set = ["+i+"];",n+="for (i=0; i<"+e.def.length+"; i++) {",n}function c(e){var n,r="",i,s;if(e.type===t.parser.STRING_LITERAL||e.type===t.parser.ID)r+=a(e);else{if(!(e.def&&e.def.length>0))throw T;if(e.def[0].type===t.parser.CONDITIONAL_EXPR)r+=u(e.def[0]);else for(n=0;n<e.def.length;n++)s=i,i=e.def[n],i.type===t.parser.TEXT?(i.val.match(/^\d+$/)||i.val.match(/^[_\$](?=(?:[^a-z0-9_$]|$))/i)||s&&s.type===t.parser.OPERATOR&&s.val==="."||(r+="$$."),r+=i.val):i.type===t.parser.OPERATOR?r+=i.val:i.type===t.parser.STRING_LITERAL&&(r+=a(i))}return r}function h(e){var t="",n,r;return n=e.def[0],r=c(n.def[0]),t+=r+" = new RLH();",t+=f(n.def[1]),n=e.def[1].def[0],t+=r+'["" + i] = ('+c(n.def[0])+" === i) ? ",t+=c(n.def[1])+" : "+c(n.def[2])+";",t+="}",t}function p(e){var t="",n,r;return n=e.def[0],r=c(n.def[0]),t+=r+" = {};",t+=l(n.def[1]),n=e.def[1].def[0],t+=r+"[_set[i]] = ("+c(n.def[0])+" === _set[i]) ? ",t+=c(n.def[1])+" : "+c(n.def[2])+";",t+="}",t}function d(e){var n="",r;return r=e.def[0],r.def[r.def.length-1].type===t.parser.RANGE_LITERAL?n+=h(e):r.def[r.def.length-1].type===t.parser.SET_LITERAL?n+=p(e):(n+=c(r),n+=" =",n+=c(e.def[1]),n+=";"),n}function v(e){return'extend(cID,"'+e.id.val+'");'}function m(e){var t,n="",r;n+="partial(function($,$$){",n+="$ = clone($) || {};",n+="$$ = clone($$) || {};",n+='var i, ret = "", ret2, _;';for(t=1;t<e.def.length;t++)r=e.def[t],n+=d(r);return n+=E(e),n+="return ret;",n+='},"'+e.id.val+'"',n+=");",n}function g(e){var t="";return t+="ret2 = esc((function(){",t+='var ret = "", ret2;',t+=E(e),t+="return ret;",t+="})(),"+JSON.stringify(e.escapes)+");",t+=S("ret","ret2"),t}function y(e){var n,r="",i;r+="ret2 = (function($,$$,_){",r+="function __iter__($,$$,value,key,index){",r+='var i, ret = "", ret2, _;',r+="if (value == null) return ret;",r+="$ = clone($);",r+="$$ = clone($$);",r+="_ = {",r+="value: value,",r+="key: key,",r+="index: index,",r+="even: (index % 2) === 0,",r+="odd: (index % 2) === 1,",r+="first: (index === 0),",r+="last: (index === len - 1)",r+="};";for(n=1;n<e.def.length;n++)i=e.def[n],r+=d(i);return r+=E(e),r+="return ret;",r+="}",r+='var i, j = 0, len, ret = "", it, tmp;',e.main_expr.def[0].type===t.parser.SET_LITERAL?(r+=l(e.main_expr.def[0]),r+="len = _set.length;",r+='ret2 = __iter__($,$$,_set[i],""+i,i);',r+=S("ret","ret2"),r+="}"):e.main_expr.def[0].type===t.parser.RANGE_LITERAL?(r+="len = "+(Math.abs(e.main_expr.def[0].def[0].val-e.main_expr.def[0].def[1].val)+1)+";",r+=f(e.main_expr.def[0]),r+='ret2 = __iter__($,$$,i,""+i,j++);',r+=S("ret","ret2"),r+="}"):(r+="it = "+c(e.main_expr)+";",r+="if (it == null) {",r+='return "";',r+="}",r+='if (Object.prototype.toString.call(it) === "[object Array]") {',r+="len = it.length;",r+="for (i=0; i<len; i++) {",r+='ret2 = __iter__($,$$,it[i],""+i,i);',r+=S("ret","ret2"),r+="}",r+='} else if (typeof it === "object") {',r+="tmp = Object.keys(it);",r+="len = tmp.length;",r+="if (it instanceof RLH) {",r+="tmp.sort(__sort_fn__);",r+="for (i=0; i<len; i++) {",r+="ret2 = __iter__($,$$,it[tmp[i]],tmp[i],i);",r+=S("ret","ret2"),r+="}",r+="} else {",r+="for (i in it) { if (it.hasOwnProperty(i)) {",r+="ret2 = __iter__($,$$,it[i],i,j++);",r+=S("ret","ret2"),r+="}}",r+="}",r+="} else {",r+="return ",r+="unerr;",r+="}"),r+="return ret;",r+="})(clone($),clone($$),clone(_));",r+=S("ret","ret2"),r}function b(e){var t="",n;return n=c(e.context_expr),t+="ret2 = "+n+";",t+="ret2 = G.render("+c(e.main_expr)+",ret2,$$);",e.escapes&&(t+="ret2 = esc(ret2,"+JSON.stringify(e.escapes)+");"),t+=S("ret","ret2"),t}function w(e){var t="",n=c(e.main_expr);return e.escapes?t+="ret += esc("+n+","+JSON.stringify(e.escapes)+");":t+="ret += "+n+";",t}function E(e){var s,o="",u;for(s=0;s<e.children.length;s++)u=e.children[s],u.type===t.parser.TEXT?o+='ret += "'+r(i(n(u.val)))+'";':u.type===t.parser.TAG_LOOP?o+=y(u):u.type===t.parser.TAG_INCL_TMPL?o+=b(u):u.type===t.parser.TAG_INCL_VAR?o+=w(u):u.type===t.parser.TAG_ESCAPE&&(o+=g(u));return o}function S(e,t){var n="";return n+=e+" += "+t+";",n}function x(e){var n,r=[],i="",u="",a;while(n=t.parser.parseNextNode()){r.push(n);if(n.type===t.parser.COLLECTION_MARKER)n.start?(a=s(n),i+=a,u+=a):n.close&&(a=o(n),i+=a,u+=a,e&&t.initializeCollection(n.close,i),i="");else if(n.type===t.parser.TAG_EXTEND){if(!(r.length>1&&r[r.length-2].type===t.parser.COLLECTION_MARKER))throw T;a=v(n),i+=a,u+=a}else{if(n.type!==t.parser.TAG_DEFINE)throw T;a=m(n),i+=a,u+=a}}return u}var T=new Error("Unknown error");t.generator={process:x}}(this.grips);var t=this.grips;typeof define=="function"&&define.amd&&define(t)}).call({});