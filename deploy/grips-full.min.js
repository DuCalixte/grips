/* grips (c) 2012 Kyle Simpson | http://getify.mit-license.org/ */
;Object.keys||(Object.keys=function(t){var n,r=[];for(n in t)t.hasOwnProperty(n)&&r.push(n);return r}),function(t){function r(){function e(){}function i(){var e=t.grips;return t.grips=n,e}function s(e){e in m||(m[e]={collection:"",extend:null,partials:{}})}function o(e,t){s(e),m[e].extend=t}function u(t){var n,r,i;if(typeof t=="object"){if(t===null)return t;if(Object.prototype.toString.call(t)==="[object Array]"){r=[];for(n=0;n<t.length;n++)typeof t[n]=="object"?i=deepClone2(t[n]):i=t[n],r.push(i)}else{t instanceof e?r=new e:r={};for(n in t)t.hasOwnProperty(n)&&(typeof (t[n]==="object")?i=u(t[n]):i=t[n],r[n]=i)}}else r=t;return r}function a(e,t,n){var r=t.match(/^(.+)#/);r&&(r=r[1]);if(!r)throw g;s(r),m[r].partials[t.replace(/^.*#/,"#")]=function(){var n,r;try{r=e.apply(v,arguments)}catch(i){throw g}if(r instanceof Error)throw r;return r}}function f(e,t){var n="",r,i;t=t!==!1;if(Object.prototype.toString.call(e)==="[object Array]")for(r=0;r<e.length;r++)n+=c(e[r],null,t);else if(typeof e=="object")for(i in e)e.hasOwnProperty(i)&&(n+=c(e[i],i,t));return n}function l(e,t){if(!t)throw g;return c(e,t,!1)}function c(e,t,n){var r;n=n!==!1;try{if(v.tokenizer.process(e,t))return v.parser.end(),v.generator.process(n)}catch(i){throw g}return!1}function h(e){var n,r;"document"in t?(n=document.createElement("script"),n.text=e,r=document.getElementsByTagName("script")[0],r.parentNode.insertBefore(n,r)):(n=new Function(e),n.call(t))}function p(e,t){s(e),h(t)}function d(e,t,n){if(!e)return"";var r,i,s,o,u=[],a=!1,f=!1;r=e.match(/^(.+)#/),r&&(r=r[1],a=!0);if(!a&&y.length>0)r=y[y.length-1];else if(!a||y.length>0&&y[y.length-1]===r){if(!r)throw g}else y.push(r),f=!0;if(r in m){e=e.replace(/^(.+)#/,"#"),o=r+e,b.push(o);for(s=0;s<b.length-1;s++)if(b[s]===o)throw g;a?u.push(r):u=u.concat(y);if(!(e in m[r].partials)&&m[r].extend){o=m[r].extend;while(o&&o in m)u.push(o),o=m[o].extend}for(s=0;s<u.length;s++)if(e in m[u[s]].partials){i=m[u[s]].partials[e](t,n);break}}if(i)return b.pop(),f&&y.pop(),i;throw g}var v,m={},g=new Error("Unknown error"),y=[],b=[];return v={extend:o,cloneObj:u,definePartial:a,compile:f,compileChunk:l,compileCollection:c,initialize:h,initializeCollection:p,render:d,noConflict:i,sandbox:r,RangeLiteralHash:e},v}var n=t.grips;t.grips=r()}(this),function(t){function n(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function r(){var e;do e=Math.floor(Math.random()*1e9);while(e in o);return e}function i(e,i){function u(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===E){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==E){n=i-1;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return e}function g(e){for(var t=0;t<e.length;t++)e[t].type===E&&(e[t].val=e[t].val.replace(/\\\\/g,"\\"));return e}function C(){var r,o;j&&(I=new n({type:null,val:j,pos:D}),j.match(/^\s+$/)?I.type=S:I.type=E,s.push(I));if(H){o=e.substring(0,_-H[0].length);if(!!o&&!o.match(x)){s.push(new n({type:E,val:H[0],pos:_-H[0].length}));return}if(H[0]==="{$}")s.push(new n({type:c,val:H[0],pos:_-H[0].length}));else{if(H[0]!=="{$")return N;I=new n({type:a,val:H[0],pos:_-H[0].length}),s.push(I);if(!(_<e.length-1&&(H=e.substr(_).match(/^(?:[:+=*\/%]|(?:define|extend|insert|print|partial|loop|comment|raw)\b)/))))return N;s.push(new n({type:h,val:H[0],pos:_})),_+=H[0].length}}s=s.concat(r=g(u(s.splice(P-s.length)))),F=t.parser.nodify(r,i),P=s.length}function k(){var e,r;if(j){if(r=j.match(/[^a-z0-9_$\s]/i))return N;s.push(new n({type:E,val:j,pos:D}))}if(H)if(H[0]==="$}")s.push(new n({type:f,val:H[0],pos:_-H[0].length}));else if(H[0]==="}")s.push(new n({type:l,val:H[0],pos:_-H[0].length}));else{if(H[0].match(/^\s+$/)){s.push(new n({type:S,val:H[0],pos:_-H[0].length}));return}if(H[0].match(/^["']$/))I=new n({type:0,val:H[0],pos:_-H[0].length}),H[0]==='"'?I.type=b:I.type=y,s.push(I),T[t.parser.LITERAL]=new RegExp(H[0],"g"),T[t.parser.LITERAL].lastIndex=0;else if(H[0].match(/^(?:\.\.)|[:=?\(\)\[\],\-.!]$/))s.push(new n({type:w,val:H[0],pos:_-H[0].length}));else if(H[0]==="|")s.push(new n({type:v,val:H[0],pos:_-H[0].length}));else{if(H[0]!=="@"){s.push(new n({type:E,val:H[0],pos:_-H[0].length}));return}s.push(new n({type:m,val:H[0],pos:_-H[0].length}))}}s=s.concat(e=g(u(s.splice(P-s.length)))),F=t.parser.nodify(e,i),P=s.length}function L(){var e,r;s[s.length-1].type!=E&&s.push(new n({type:E,val:"",pos:D})),j&&(s[s.length-1].val+=j),H&&(r=s[s.length-1].val,!r||r.match(x)?(s.push(new n({type:d,val:H[0],pos:_-H[0].length})),s=s.concat(e=g(u(s.splice(P-s.length)))),F=t.parser.nodify(e,i),P=s.length):(r&&!r.match(x)&&(s[s.length-1].val=s[s.length-1].val.substr(0,s[s.length-1].val.length-1)),s[s.length-1].val+=H[0]))}function A(){var e,r;if(H){r=s[s.length-1].val;if(!r||r.match(x))s.push(new n({type:p,val:H[0],pos:_-H[0].length})),s=s.concat(e=g(u(s.splice(P-s.length)))),F=t.parser.nodify(e,i),P=s.length}}function O(){var e,r;s[s.length-1].type!=E&&s.push(new n({type:E,val:"",pos:D})),j&&(s[s.length-1].val+=j),H&&(r=s[s.length-1].val,!r||r.match(x)?(s.push(new n({type:H[0]==='"'?b:y,val:H[0],pos:_-H[0].length})),s=s.concat(e=g(u(s.splice(P-s.length)))),F=t.parser.nodify(e,i),P=s.length,T[t.parser.STRING_LITERAL]=null):(r&&!r.match(x)&&(s[s.length-1].val=s[s.length-1].val.substr(0,s[s.length-1].val.length-1)),s[s.length-1].val+=H[0]))}var M,_=0,D=0,P=s.length,H,B,j,F,I,q,R=[C,k,L,A,O];i||(i=r(),o[i]=!0,i="chunk_"+i);while((!F||F===!0)&&_<e.length){F=null,B=t.parser.state;if(B===t.parser.INVALID)break;M=T[B];if(!M){F=N;break}j="",M.lastIndex=_,H=M.exec(e);if(H)D=_,_=M.lastIndex,D<_-H[0].length&&(j=e.substring(D,_-H[0].length));else{D=_,_=e.length,j=e.substr(D);if(!j)break}q=R[B]();if(q&&q!==!0)break;if(F&&F!==!0)break}if(q instanceof Error)throw q;if(F instanceof Error)throw F;return!0}var s=[],o={},u=0,a=0,f=1,l=2,c=3,h=4,p=5,d=6,v=7,m=8,g=9,y=10,b=11,w=12,E=13,S=14,x=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,T=[/\{\$\}|\{\$/g,/\$\}|\}|(?:\.\.)|["':=@\|?\(\)\[\],\-.!]|\s+/g,/%\$\}/g,/\/\$\}/g],N=new Error("Unknown error");t.tokenizer={OPEN:a,SIMPLE_CLOSE:f,BLOCK_HEAD_CLOSE:l,BLOCK_FOOTER:c,SIGNIFIER:h,COMMENT_CLOSE:p,RAW_CLOSE:d,PIPE:v,AT:m,STRING_LITERAL:g,SINGLE_QUOTE:y,DOUBLE_QUOTE:b,OPERATOR:w,GENERAL:E,WHITESPACE:S,process:i,Token:n}}(this.grips),function(t){function n(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function r(e,r){function i(e){if(e.type===t.tokenizer.OPEN)l=new n({parent:null,type:null,token:e,def:[],children:[],complete:!1}),p?(l.parent=p,p.children.push(l)):(delete l.parent,h.push(l)),p=l,W.state=g;else if(e.type===t.tokenizer.GENERAL)l=new n({parent:null,type:S,token:e,val:e.val}),p?(l.parent=p,p.children.push(l)):(delete l.parent,h.push(l));else if(p&&e.type===t.tokenizer.WHITESPACE)l=new n({parent:p,type:S,token:e,val:e.val}),p.children.push(l);else if(e.type===t.tokenizer.BLOCK_FOOTER){if(!p||p.close_header!==t.tokenizer.BLOCK_HEAD_CLOSE)return W.state=E,X;p.complete=!0,p=p.parent}}function s(e){function i(){if(p.type===C||p.type===N||p.type===k){l=new n({parent:p,type:null,token:null,def:[]});if(!p.main_expr&&p.type===k)p.main_expr=l,l.type=M;else if(p.type===C||p.type===N){if(!!p.main_expr)return W.state=E,X;p.main_expr=l,l.type=M,p.type===N&&(l.collection_id=r)}else l.type=_;p.def.push(l),p=l}}if(e.type===t.tokenizer.SIGNIFIER){if(!p||p.type!=null)return W.state=E,X;e.val.match(/^(?:\:|define)$/)?p.type=T:e.val.match(/^(?:\+|extend)$/)?p.type=x:e.val.match(/^(?:\=|insert|print)$/)?p.type=C:e.val.match(/^partial$/)?p.type=N:e.val.match(/^(?:\*|loop)$/)?p.type=k:e.val.match(/^(?:\%|raw)$/)?p.type=L:e.val.match(/^(?:\/|comment)$/)&&(p.type=A),p.type===x||p.type===C?(p.close_header=t.tokenizer.SIMPLE_CLOSE,delete p.children):p.type===N?p.close_header=t.tokenizer.SIMPLE_CLOSE:p.type===T||p.type===k?p.close_header=t.tokenizer.BLOCK_HEAD_CLOSE:p.type===L?(p.val="",W.state=y,delete p.def,delete p.children):p.type===A&&(p.val="",W.state=b,delete p.def,delete p.children);if(!p.parent&&p.type!==x&&p.type!==T&&p.type!==A)return W.state=E,X}else if(e.type===t.tokenizer.WHITESPACE){if(p){if(p.type!==x&&p.type!==T&&p.type!==N&&p.type!==C&&p.type!==k&&p.type!==_&&p.type!==M)return W.state=E,X;p.def.length>0&&p.def.push(new n({parent:p,type:R,token:e}))}}else if(e.type===t.tokenizer.AT){if(!p||p.type!==C||p.def.length!==0)return W.state=E,X;p.type=N}else if(e.type===t.tokenizer.SINGLE_QUOTE||e.type===t.tokenizer.DOUBLE_QUOTE){if(!p||p.type!==x&&p.type!==T&&p.type!==N&&p.type!==_&&p.type!==M)return W.state=E,X;W.state=w,l=new n({parent:p,type:null,token:e,val:"",delimiter:e.val});if(p.type===T||p.type===x){if(!!p.id)return W.state=E,X;p.id=l,l.type=O,p.type===T&&(l.collection_id=r)}else if(p.type===N){if(!!p.main_expr)return W.state=E,X;p.main_expr=l,l.type=O,l.collection_id=r}else l.type=F;p.def.push(l),p=l}else if(e.type===t.tokenizer.OPERATOR){if(!p)return W.state=E,X;e.val.match(/[\(\[]/)&&i();if(p.type!==_&&p.type!==M)return W.state=E,X;p.token||(p.token=e);if(e.val==="-"&&p.def.length>0&&p.def[p.def.length-1].type!==R&&(p.def[p.def.length-1].type!==U||!p.def[p.def.length-1].val.match(/(?:\.\.)|\[/)))return X;p.def.push(new n({parent:p,type:U,token:e,val:e.val}))}else if(e.type===t.tokenizer.PIPE){if(!p)return W.state=E,X;if(p.type===_||p.type===M)p=p.parent;if(!p.id&&(p.type===T||p.type===x))return W.state=E,X;if(!(p.type===T||p.type===k||p.type===N&&!p.context_expr))return W.state=E,X;l=new n({parent:p,type:_,token:null,def:[]}),p.type===N&&(p.context_expr=l),p.def.push(l),p=l}else if(e.type===t.tokenizer.SIMPLE_CLOSE){if(!p)return W.state=E,X;if(p.type===_||p.type===M)p=p.parent;if(!p.id&&p.type===x)return W.state=E,X;if(p.close_header!==t.tokenizer.SIMPLE_CLOSE)return W.state=E,X;p.type===N&&!p.context_expr&&(l=new n({parent:p,type:_,token:null,def:[]}),l.def.push(new n({parent:l,type:S,token:null,val:"$"})),p.context_expr=l,p.def.push(l)),p.complete=!0,W.state=m,p=p.parent}else if(e.type===t.tokenizer.BLOCK_HEAD_CLOSE){if(!p)return W.state=E,X;if(p.type===_||p.type===M)p=p.parent;if(!p.id&&p.type===T)return W.state=E,X;if(p.close_header!==t.tokenizer.BLOCK_HEAD_CLOSE)return W.state=E,X;W.state=m}else if(e.type===t.tokenizer.GENERAL){if(!p)return W.state=E,X;i();if(p.type!==_&&p.type!==M)return W.state=E,X;p.token||(p.token=e),e.val.match(/^\d+$/)&&p.def.length>0&&p.def[p.def.length-1].type===U&&p.def[p.def.length-1].val==="-"?p.def[p.def.length-1]=new n({parent:p,type:S,token:new t.tokenizer.Token({type:t.tokenizer.GENERAL,val:"-"+e.val,pos:e.pos-1}),val:"-"+e.val}):p.def.push(new n({parent:p,type:S,token:e,val:e.val}))}}function o(e){if(e.type===t.tokenizer.GENERAL)p.token.type!==t.tokenizer.GENERAL&&(p.token=e),p.val+=e.val;else{if(e.type!==t.tokenizer.RAW_CLOSE)return X;p.complete=!0,p=p.parent,W.state=m}}function u(e){e.type===t.tokenizer.COMMENT_CLOSE&&(p=p.parent,p?p.children.pop():h.pop(),W.state=m)}function a(e){if(e.type===t.tokenizer.GENERAL)p.token.type!==t.tokenizer.GENERAL&&(p.token=e),p.val+=e.val;else{if(e.type!==t.tokenizer.SINGLE_QUOTE&&e.type!==t.tokenizer.DOUBLE_QUOTE||p.delimiter!==e.val)return X;p=p.parent,W.state=g}}var f,l,c,v=[i,s,o,u,a];r!==d&&(d&&h.push(new n({type:z,close:d,complete:!0})),d=r,h.push(new n({type:z,start:r,complete:!0})));for(f=0;f<e.length;f++){if(W.state===E)return X;c=v[W.state](e[f]);if(c)return c}return!0}function i(){d&&h.push(new n({type:z,close:d,complete:!0})),d=null}function s(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===S){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==S){n--;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].token.val+=e[i].token.val,e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return o(e)}function o(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===R){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==R){n--;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].token.val+=e[i].token.val,e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return e}function u(e){var t=[],n=0,r=e.length-1;while(n<=r){e[n].type===R&&n++,e[r].type===R&&r--;if(!(n<r)||e[n].type!==R&&e[r].type!==R)break}return n<=r&&(t=e.slice(n,r+1)),t}function a(e){var t=[],n=0,r=e.length-1,i,s=0;while(n<r){e[n].type===R&&n++,e[r].type===R&&r--;if(n<r&&e[n].type!==R&&e[r].type!==R){if(e[n].type!==U||e[n].val!=="("||e[r].type!==U||e[r].val!==")")break;for(i=n+1;i<r;i++)if(e[i].type===U){e[i].val==="("?s++:e[i].val===")"&&s--;if(s<0)break}if(s!==0)break;n++,r--}}return n<=r&&(t=e.slice(n,r+1)),t}function f(e){for(var t=0;t<e.length;t++)e[t].type===U&&(e.splice(t,1),t--)}function l(e){function r(e){var t,n,r=[],i=!1;if(e.length<5)return!1;if(e[0].type!==U||e[0].val!=="[")return!1;r.push(e[0]);for(t=1;t<e.length;t++){if(e[t].type===R)continue;r.push(e[t]);if(e[t].type===U){if(e[t].val==="]")break;if(!e[t].val.match(/(?:\.\.)|[\-,]/))return!1;e[t].val.match(/(?:\.\.)|,/)&&(i=!0)}}return r.length<5||!i?!1:r}function i(e){function t(e,t,r){var i,s;e=a(e),i=new n({parent:u,type:t,token:e[0].token,def:e}),E=r(i);if(E)return E;for(s=0;s<i.def.length;s++)i.def[s].parent=i;return i}var r,i,s=[],o,u,f,l,c;if(e.length>0){for(r=0;r<e.length;r++){i=e[r];if(i.type===U&&i.val.match(/[?:]/)){if(i.val==="?"){if(!!u)return!1;u=new n({parent:null,type:B,token:e[0].token,def:[]}),f=t(s,j,h);if(f instanceof Error)throw f;c=new n({parent:u,type:H,token:null,def:[]}),o=new n({parent:c,type:F,token:null,val:"",delimiter:'"'}),c.def.push(o),s=[]}else if(i.val===":"){if(!u||!!l)return!1;l=t(s,H,m);if(l instanceof Error)throw l;s=[]}}else s.push(i)}if(s.length>0){if(!u)return!1;if(!l){l=t(s,H,m);if(l instanceof Error)throw l}else{c=t(s,H,m);if(c instanceof Error)throw c}s=[]}if(f&&l)return u.def.push(f,l,c),u}}function c(e){var t;if((t=e.val.match(/#/g))&&t.length>1)return new ParserError("Unexpected extra #id",e);if(e.parent.type===T){if(!e.val)return X;if(t=e.val.match(/(#.*?)([^a-z0-9_\-$.]).*$/i))return X;if(!e.val.match(/^#/))return X;e.val=e.collection_id+e.val}else if(e.parent.type===x){if(t=e.val.match(/#/))return X}else if(e.parent.type===N){if(!e.val)return X;if(t=e.val.match(/(#.*?)([^a-z0-9_\-$.]).*$/i))return X}}function h(e){function n(e){while(e.parent&&(e=e.parent))if(e.type===t.parser.TAG_LOOP)return!0;return!1}function r(e){while(e.parent&&(e=e.parent))if(e.type===t.parser.MAIN_REF_EXPR||e.type===t.parser.ASSIGNMENT_EXPR)return e.type===t.parser.MAIN_REF_EXPR;return!1}var i,s,o,u,a=[];if(!(e.def&&e.def.length>0))return X;for(i=0;i<e.def.length;i++){if(e.def[i].type===R)continue;o=u,u=e.def[i];if(u.type===U){if(!u.val.match(/[.!\[\]\(\)]/))return X;if(o)if(o.type===U){if(u.val==="("&&!o.val.match(/[!\(\[]/))return X;if(u.val==="!"&&!o.val.match(/[!\(]/))return X;if(u.val.match(/[.\[\]\)]/)&&!o.val.match(/[\]\)]/))return X}else{if(o.type===S&&!u.val.match(/[.\[\]\)]/))return X;if(o.type===F&&!u.val.match(/[\]\)]/))return X}else if(!u.val.match(/[!\(]/))return X;if(u.val.match(/[\[\(]/))a.push(u.val);else if(u.val.match(/[\]\)]/)){if(!(a.length>0&&(a[a.length-1]==="["&&u.val==="]"||a[a.length-1]==="("&&u.val===")")))return X;a.pop()}}else if(u.type===S){if(u.val.match(/^\d/)){if(!u.val.match(/^\d+$/))return X;if(o&&(o.type!==U||!o.val.match(/[\(\[]/)))return X}s=r(u);if(e.def.length===1&&u.val==="_"&&!s&&u.parent.parent.context_expr!==u.parent)return X;if(u.val==="_"&&!(s&&n(u.parent.parent)||!s&&n(u)))return X;if(o){if(o.type===S)return X;if(o.type===U&&!o.val.match(/[.!\(\[]/))return X}}else if(u.type===F&&o&&(o.type!==U||!o.val.match(/[\[\(]/)))return X}if(a.length>0)return X}function p(e){if(!e.def||e.def.length!==5)return X;if(e.def[1].type!==S||!e.def[1].val.match(/^-?\d+$/))return X;if(e.def[3].type!==S||!e.def[3].val.match(/^-?\d+$/))return X;if(e.def[2].type!==U||e.def[2].val!=="..")return X}function d(e){var t,n,r,i;if(!(e.def&&e.def.length>=5))return X;for(t=1;t<e.def.length-1;t++){r=i,i=e.def[t];if(i.type===F){if(r&&(r.type!==U||r.val!==","))return X}else{if(i.type!==U||i.val!==",")return X;if(!r||r.type!==F)return X}}if(e.def[e.def.length-2].type!==F)return X}function v(e){var t,s,o,l,c,h,v=[],y,b;if(!(e.def&&e.def.length>0))return X;for(t=0;t<e.def.length;t++){if(e.def[t].type===R)continue;o=l,l=e.def[t];if(!!y){c=a(e.def.slice(t));if(c.length===0)return X;b=new n({parent:e,type:H,token:c[0].token,def:[]}),h=i(c);if(!h){b.def=c,E=m(b);if(E)return E}else b.def=[h];for(s=0;s<b.def.length;s++)b.def[s].parent=b;break}if(l.type===U)if(l.val==="="){y=new n({parent:e,type:P,token:v[0].token,def:v});if(!v[0]||v[0].type!==P||!v[1]||v[1].type!==q&&v[1].type!==I){E=g(y);if(E)return E}for(s=0;s<y.def.length;s++)y.def[s].parent=y;v=[]}else if(l.val==="["){c=r(e.def.slice(t));if(c){h=new n({parent:null,type:P,token:e.def[0].token,def:e.def.slice(0,t)}),E=g(h),E||(v=[h],h=new n({parent:null,type:I,token:l.token,def:c}),E=p(h),E&&(h.type=q,E=d(h)),E?E=X:(v.push(h),t+=c.length-1,f(h.def)));if(E)return E}else v.push(l)}else{if(!o||!l.val.match(/[.\[\]]/))return X;v.push(l)}else v.push(l)}if(!y||!b)return X;y.def=u(y.def),b.def=u(b.def),e.def=[y,b],e.type=D}function m(e){var t,n,r,i=!1;if(!(e.def&&e.def.length>0))return X;for(t=0;t<e.def.length;t++){n=e.def[t];if(n.type===U){if(n.val==="!")return X}else if(n.type===S)if(!n.val.match(/^\d+$/))i=!0;else if(!i)return X}r=h(e);if(r)return r}function g(e){var t,n,r,i;if(!(e.def&&e.def.length>0))return X;for(t=0;t<e.def.length;t++){if(e.def[t].type===R)continue;n=r,r=e.def[t];if(r.type===F&&(!n||n.type!==U||n.val!=="["))return X}i=m(e);if(i)return i}var y,b,w,E,A,z;if(e.type===x){if(!e.id||!(y=l(e.id)))throw X;e.id=y;if(e.def&&e.def.length){e.def[0]=e.id;if(e.def.length>1){for(z=1;z<e.def.length;z++)if(e.def[z].type!==R)throw X;e.def=[e.id]}}return e}if(e.type===T){if(!e.id||!(y=l(e.id)))throw X;e.id=y;if(e.def&&e.def.length){y=[e.id],w=u(e.def.slice(1));for(z=0;z<w.length;z++)b=l(w[z]),b&&y.push(b);e.def=y}if(e.children&&e.children.length){e.children=s(e.children),y=[];for(z=0;z<e.children.length;z++)b=l(e.children[z]),b&&y.push(b);e.children=s(y)}return e}if(e.type===k){if(!e.main_expr||!(y=l(e.main_expr)))throw X;e.main_expr=y;if(e.def&&e.def.length){y=[e.main_expr],w=u(e.def.slice(1));for(z=0;z<w.length;z++)b=l(w[z]),b&&y.push(b);e.def=y}if(e.children&&e.children.length){e.children=s(e.children),y=[];for(z=0;z<e.children.length;z++)b=l(e.children[z]),b&&y.push(b);e.children=s(y)}return e}if(e.type===C){if(!e.main_expr||!(y=l(e.main_expr)))throw X;e.main_expr=y;if(e.def&&e.def.length){if(e.def.length>1)for(z=1;z<e.def.length;z++)if(e.def[z].type!==R)throw X;e.def=[e.main_expr]}return e}if(e.type===N){if(!e.main_expr||!(y=l(e.main_expr)))throw X;e.main_expr=y,e.context_expr.type=P,e.context_expr.def=u(e.context_expr.def),E=g(e.context_expr);if(E)throw E;return e.def=[e.main_expr,e.context_expr],e}if(e.type===L)return e.type=S,e;if(e.type===O){if(E=c(e))throw E;return e}if(e.type===_){if(!e.def||!e.def.length)throw X;e.def=o(e.def),e.def=u(e.def),E=v(e);if(E)throw E;return e}if(e.type===M){if(!e.def||!e.def.length)throw X;y=[];for(z=0;z<e.def.length;z++)e.def[z].type!==R&&y.push(e.def[z]);e.def=a(y);if((y=r(e.def))&&y.length===e.def.length){y=new n({parent:e,type:null,token:e.token,def:y});for(z=0;z<y.def.length;z++)y.def[z].parent=y;E=p(e),E?(E=d(e),E||(y.type=q)):y.type=I;if(E)throw X;f(y.def),e.def=[y]}else e.parent.type===C||e.parent.type===k?E=g(e):e.parent.type===N&&(E=m(e));if(E)throw E;return e}if(e.type===F)return e;if(e.type!==S)return e;if(e.val!=="")return e}function c(){var e;while(v<h.length&&!e&&h[v].complete)e=l(h[v++]);return e}var h=[],p,d="",v=0,m=0,g=1,y=2,b=3,w=4,E=5,S=0,x=1,T=2,N=3,C=4,k=5,L=6,A=7,O=8,M=9,_=10,D=11,P=12,H=13,B=14,j=15,F=16,I=17,q=18,R=19,U=20,z=21,W,X=new Error("Unknown error");W={OUTSIDE:m,INSIDE:g,RAW:y,COMMENT:b,LITERAL:w,INVALID:E,TEXT:S,TAG_EXTEND:x,TAG_DEFINE:T,TAG_INCL_TMPL:N,TAG_INCL_VAR:C,TAG_LOOP:k,TAG_RAW:L,TAG_COMMENT:A,ID:O,MAIN_REF_EXPR:M,GENERAL_EXPR:_,ASSIGNMENT_EXPR:D,REF_EXPR:P,VAL_EXPR:H,CONDITIONAL_EXPR:B,BOOLEAN_EXPR:j,STRING_LITERAL:F,RANGE_LITERAL:I,SET_LITERAL:q,WHITESPACE:R,OPERATOR:U,COLLECTION_MARKER:z,state:m,nodify:r,end:i,parseNextNode:c,Node:n},t.parser=W}(this.grips),function(t){function n(e){return e.replace(/\\([\s\S])|(")/g,"\\$1$2")}function r(e){return e.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}function i(e){return e.replace(/\\(?!\\*\")/g,"\\\\")}function s(e){return e=e.replace(/[^a-z0-9_$]/ig,"_"),e}function o(e){var t="";return t+="(function(G){ ",t+="function __sort_fn__(a,b){ return a-b; } ",t+="var partial = G.definePartial, clone = G.cloneObj, extend = G.extend, ",t+="RLH = G.RangeLiteralHash, ",t+='cID = "'+e.start+'"; ',t}function u(e){return"})(this.grips); "}function a(e){return h(e.def[0])+" ? "+h(e.def[1])+" : "+h(e.def[2])}function f(e){return e.delimiter+e.val+e.delimiter}function l(e){var t="";return t+="for (i="+e.def[0].val+"; i",e.def[0].val<=e.def[1].val?t+="<="+e.def[1].val+"; i++) { ":t+=">="+e.def[1].val+"; i--) { ",t}function c(e){var t,n="",r,i;i="";for(t=0;t<e.def.length;t++)r=e.def[t],i+=(i!==""?",":"")+f(r);return n+="var _set = ["+i+"]; ",n+="for (i=0; i<"+e.def.length+"; i++) { ",n}function h(e){var n,r="",i,s;if(e.type===t.parser.STRING_LITERAL||e.type===t.parser.ID)r+=f(e);else{if(!(e.def&&e.def.length>0))throw T;if(e.def[0].type===t.parser.CONDITIONAL_EXPR)r+=a(e.def[0]);else for(n=0;n<e.def.length;n++)s=i,i=e.def[n],i.type===t.parser.TEXT?(i.val.match(/^\d+$/)||i.val.match(/^[_\$](?=(?:[^a-z0-9_$]|$))/i)||s&&s.type===t.parser.OPERATOR&&s.val==="."||(r+="$$."),r+=i.val):i.type===t.parser.OPERATOR?r+=i.val:i.type===t.parser.STRING_LITERAL&&(r+=f(i))}return r}function p(e){var t="",n,r;return n=e.def[0],r=h(n.def[0]),t+=r+" = new RLH(); ",t+=l(n.def[1]),n=e.def[1].def[0],t+=r+'["" + i] = ('+h(n.def[0])+" === i) ? ",t+=h(n.def[1])+" : "+h(n.def[2])+"; ",t+="} ",t}function d(e){var t="",n,r;return n=e.def[0],r=h(n.def[0]),t+=r+" = {}; ",t+=c(n.def[1]),n=e.def[1].def[0],t+=r+"[_set[i]] = ("+h(n.def[0])+" === _set[i]) ? ",t+=h(n.def[1])+" : "+h(n.def[2])+"; ",t+="} ",t}function v(e){var n="",r;return r=e.def[0],r.def[r.def.length-1].type===t.parser.RANGE_LITERAL?n+=p(e):r.def[r.def.length-1].type===t.parser.SET_LITERAL?n+=d(e):(n+=h(r),n+=" = ",n+=h(e.def[1]),n+="; "),n}function m(e){return'extend(cID,"'+e.id.val+'"); '}function g(e){var t,n="",r;n+="partial(function($,$$){ ",n+="$ = clone($) || {}; ",n+="$$ = clone($$) || {}; ",n+='var i, ret = "", ret2, _; ';for(t=1;t<e.def.length;t++)r=e.def[t],n+=v(r);return n+=E(e),n+="return ret; ",n+='},"'+e.id.val+'"',n+="); ",n}function y(e){var n,r="",i,s;r+="ret2 = (function($,$$,_){ ",r+="function __iter__($,$$,value,key,index){ ",r+='var i, ret = "", ret2, _; ',r+="if (value == null) return ret; ",r+="$ = clone($); ",r+="$$ = clone($$); ",r+="_ = { ",r+="value: value, ",r+="key: key, ",r+="index: index, ",r+="even: (index % 2) === 0, ",r+="odd: (index % 2) === 1, ",r+="first: (index === 0), ",r+="last: (index === len - 1) ",r+="}; ";for(n=1;n<e.def.length;n++)i=e.def[n],r+=v(i);return r+=E(e),r+="return ret; ",r+="} ",r+='var i, j = 0, len, ret = "", it, tmp; ',e.main_expr.def[0].type===t.parser.SET_LITERAL?(r+=c(e.main_expr.def[0]),r+="len = _set.length; ",r+='ret2 = __iter__($,$$,_set[i],""+i,i); ',r+=S("ret","ret2"),r+="} "):e.main_expr.def[0].type===t.parser.RANGE_LITERAL?(r+="len = "+(Math.abs(e.main_expr.def[0].def[0].val-e.main_expr.def[0].def[1].val)+1)+"; ",r+=l(e.main_expr.def[0]),r+='ret2 = __iter__($,$$,i,""+i,j++); ',r+=S("ret","ret2"),r+="} "):(r+="it = "+h(e.main_expr)+"; ",r+="if (it == null) { ",r+='return ""; ',r+="} ",r+='if (Object.prototype.toString.call(it) === "[object Array]") { ',r+="len = it.length; ",r+="for (i=0; i<len; i++) { ",r+='ret2 = __iter__($,$$,it[i],""+i,i); ',r+=S("ret","ret2"),r+="} ",r+='} else if (typeof it === "object") { ',r+="tmp = Object.keys(it); ",r+="len = tmp.length; ",r+="if (it instanceof RLH) { ",r+="tmp.sort(__sort_fn__); ",r+="for (i=0; i<len; i++) { ",r+="ret2 = __iter__($,$$,it[tmp[i]],tmp[i],i); ",r+=S("ret","ret2"),r+="} ",r+="} else { ",r+="for (i in it) { if (it.hasOwnProperty(i)) { ",r+="ret2 = __iter__($,$$,it[i],i,j++); ",r+=S("ret","ret2"),r+="}} ",r+="} ",r+="} else { ",r+="return ",r+='new Error("Unknown error"); ',r+="} "),r+="return ret; ",r+="})(clone($),clone($$),clone(_)); ",r+=S("ret","ret2"),r}function b(e){var t="",n;return n=h(e.context_expr),t+="ret2 = "+n+"; ",t+="ret2 = G.render("+h(e.main_expr)+",ret2,$$); ",t+=S("ret","ret2"),t}function w(e){var t="";return t+="ret += "+h(e.main_expr)+"; ",t}function E(e){var s,o="",u;for(s=0;s<e.children.length;s++)u=e.children[s],u.type===t.parser.TEXT?o+='ret += "'+r(i(n(u.val)))+'"; ':u.type===t.parser.TAG_LOOP?o+=y(u):u.type===t.parser.TAG_INCL_TMPL?o+=b(u):u.type===t.parser.TAG_INCL_VAR&&(o+=w(u));return o}function S(e,t){var n="";return n+=e+" += "+t+"; ",n}function x(e){var n,r=[],i="",s="",a;while(n=t.parser.parseNextNode()){r.push(n);if(n.type===t.parser.COLLECTION_MARKER)n.start?(a=o(n),i+=a,s+=a):n.close&&(a=u(n),i+=a,s+=a,e&&t.initializeCollection(n.close,i),i="");else if(n.type===t.parser.TAG_EXTEND){if(!(r.length>1&&r[r.length-2].type===t.parser.COLLECTION_MARKER))throw T;a=m(n),i+=a,s+=a}else n.type===t.parser.TAG_DEFINE&&(a=g(n),i+=a,s+=a)}return s}var T=new Error("Unknown error");t.generator={process:x}}(this.grips);