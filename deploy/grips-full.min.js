/* grips (c) 2012 Kyle Simpson | http://getify.mit-license.org/ */
;Object.keys||(Object.keys=function(t){var n,r=[];for(n in t)t.hasOwnProperty(n)&&r.push(n);return r}),function(t){function r(){function e(){}function i(){var e=t.grips;return t.grips=n,e}function s(e){e in g||(g[e]={collection:"",extend:null,partials:{}})}function o(e,t){s(e),g[e].extend=t}function u(t){var n,r,i;if(typeof t=="object"){if(t===null)return t;if(Object.prototype.toString.call(t)==="[object Array]"){r=[];for(n=0;n<t.length;n++)typeof t[n]=="object"?i=u(t[n]):i=t[n],r.push(i)}else{t instanceof e?r=new e:r={};for(n in t)t.hasOwnProperty(n)&&(typeof (t[n]==="object")?i=u(t[n]):i=t[n],r[n]=i)}}else r=t;return r}function a(e,t){var n=t.match(/^(.+)#/);n&&(n=n[1]);if(!n)throw y;s(n),g[n].partials[t.replace(/^.*#/,"#")]=function(){var n;try{n=e.apply(m,arguments)}catch(r){throw y}if(n instanceof Error)throw n;return n}}function f(e,t){var n="",r,i;t=t!==!1;if(Object.prototype.toString.call(e)==="[object Array]")for(r=0;r<e.length;r++)n+=c(e[r],null,t);else if(typeof e=="object")for(i in e)e.hasOwnProperty(i)&&(n+=c(e[i],i,t));return n}function l(e,t){if(!t)throw y;return c(e,t,!1)}function c(e,t,n){n=n!==!1;try{if(m.tokenizer.process(e,t))return m.parser.end(),m.generator.process(n)}catch(r){throw y}return!1}function h(e){var n,r;"document"in t?(n=document.createElement("script"),n.text=e,r=document.getElementsByTagName("script")[0],r.parentNode.insertBefore(n,r)):(n=new Function(e),n.call(t))}function p(e,t){s(e),h(t)}function d(e,t,n){if(!e)return"";var r,i,s,o,u=[],a=!1,f=!1;r=e.match(/^(.+)#/),r&&(r=r[1],a=!0);if(!a&&b.length>0)r=b[b.length-1];else if(!a||b.length>0&&b[b.length-1]===r){if(!r)throw y}else b.push(r),f=!0;if(r in g){e=e.replace(/^(.+)#/,"#"),o=r+e,w.push(o);for(s=0;s<w.length-1;s++)if(w[s]===o)throw y;a?u.push(r):u=u.concat(b);if(!(e in g[r].partials)&&g[r].extend){o=g[r].extend;while(o&&o in g)u.push(o),o=g[o].extend}for(s=0;s<u.length;s++)if(e in g[u[s]].partials){i=g[u[s]].partials[e](t,n);break}}if(i)return w.pop(),f&&b.pop(),i;throw y}function v(e,t){return typeof e=="string"&&(t.html&&/[&<>"]/.test(e)&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/,"&quot;")),t.string&&(e=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\t/g,"\\t")),t.url&&(e=encodeURIComponent(e))),e}var m,g={},y=new Error("Unknown error"),b=[],w=[];return m={extend:o,cloneObj:u,definePartial:a,strEscapes:v,compile:f,compileChunk:l,compileCollection:c,initialize:h,initializeCollection:p,render:d,noConflict:i,sandbox:r,RangeLiteralHash:e,collections:g},m}var n=t.grips;t.grips=r()}(this),function(t,n){function r(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function i(){var e;do e=Math.floor(Math.random()*1e9);while(e in u);return e}function s(e,t){function s(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===E){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==E){n=i-1;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return e}function g(e){for(var t=0;t<e.length;t++)e[t].type===E&&(e[t].val=e[t].val.replace(/\\\\/g,"\\"));return e}function k(){var i,u;F&&(q=new r({type:null,val:F}),F.match(/^\s+$/)?q.type=S:q.type=E,o.push(q));if(B){u=e.substring(0,D-B[0].length);if(!!u&&!u.match(T)){o.push(new r({type:E,val:B[0]}));return}if(B[0]==="{$}")o.push(new r({type:c,val:B[0]}));else{if(B[0]!=="{$")return C;q=new r({type:a,val:B[0]}),o.push(q);if(!(D<e.length-1&&(B=e.substr(D).match(/^(?:(?:~|escape\s+)[hsuHSU]+|[~:+=*\/%]|(?:(?:define|extend|insert|print|partial|loop|comment|raw|escape)\b))/))))return C;o.push(new r({type:h,val:B[0]})),D+=B[0].length}}o=o.concat(i=g(s(o.splice(H-o.length)))),I=n.parser.nodify(i,t),H=o.length}function L(){var e,i;if(F){if(i=F.match(/[^a-z0-9_$\s]/i))return C;o.push(new r({type:E,val:F}))}if(B)if(B[0]==="$}")o.push(new r({type:f,val:B[0]}));else if(B[0]==="}")o.push(new r({type:l,val:B[0]}));else{if(B[0].match(/^\s+$/)){o.push(new r({type:S,val:B[0]}));return}if(B[0].match(/^["']$/))q=new r({type:0,val:B[0]}),B[0]==='"'?q.type=b:q.type=y,o.push(q),N[n.parser.LITERAL]=new RegExp(B[0],"g"),N[n.parser.LITERAL].lastIndex=0;else if(B[0].match(/^(?:\.\.)|[:=?\(\)\[\],\-.!]$/))o.push(new r({type:w,val:B[0]}));else if(B[0]==="|")o.push(new r({type:v,val:B[0]}));else if(B[0]==="@")o.push(new r({type:m,val:B[0]}));else{if(!B[0].match(/^~[hsuHSU]*$/)){o.push(new r({type:E,val:B[0]}));return}o.push(new r({type:x,val:B[0]}))}}o=o.concat(e=g(s(o.splice(H-o.length)))),I=n.parser.nodify(e,t),H=o.length}function A(){var e,i;o[o.length-1].type!==E&&o.push(new r({type:E,val:""})),F&&(o[o.length-1].val+=F),B&&(i=o[o.length-1].val,!i||i.match(T)?(o.push(new r({type:d,val:B[0]})),o=o.concat(e=g(s(o.splice(H-o.length)))),I=n.parser.nodify(e,t),H=o.length):(i&&!i.match(T)&&(o[o.length-1].val=o[o.length-1].val.substr(0,o[o.length-1].val.length-1)),o[o.length-1].val+=B[0]))}function O(){var e,i;if(B){i=o[o.length-1].val;if(!i||i.match(T))o.push(new r({type:p,val:B[0]})),o=o.concat(e=g(s(o.splice(H-o.length)))),I=n.parser.nodify(e,t),H=o.length}}function M(){var e,i;o[o.length-1].type!==E&&o.push(new r({type:E,val:""})),F&&(o[o.length-1].val+=F),B&&(i=o[o.length-1].val,!i||i.match(T)?(o.push(new r({type:B[0]==='"'?b:y,val:B[0]})),o=o.concat(e=g(s(o.splice(H-o.length)))),I=n.parser.nodify(e,t),H=o.length,N[n.parser.STRING_LITERAL]=null):(i&&!i.match(T)&&(o[o.length-1].val=o[o.length-1].val.substr(0,o[o.length-1].val.length-1)),o[o.length-1].val+=B[0]))}var _,D=0,P=0,H=o.length,B,j,F,I,q,R,U=[k,L,A,O,M];t||(t=i(),u[t]=!0,t="chunk_"+t);while((!I||I===!0)&&D<e.length){F="",I=null,j=n.parser.state;if(j===n.parser.INVALID)break;_=N[j];if(!_){I=C;break}F="",_.lastIndex=D,B=_.exec(e);if(B)P=D,D=_.lastIndex,P<D-B[0].length&&(F=e.substring(P,D-B[0].length));else{P=D,D=e.length,F=e.substr(P);if(!F)break}R=U[j]();if(R&&R!==!0)break;if(I&&I!==!0)break}if(R instanceof Error)throw R;if(I instanceof Error)throw I;return!0}var o=[],u={},a=0,f=1,l=2,c=3,h=4,p=5,d=6,v=7,m=8,g=9,y=10,b=11,w=12,E=13,S=14,x=15,T=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,N=[/\{\$\}|\{\$/g,/\$\}|\}|(?:\.\.)|(?:~[hsuHSU]*)|["':=@\|?\(\)\[\],\-.!]|\s+/g,/%\$\}/g,/\/\$\}/g],C=new Error("Unknown error");n.tokenizer={OPEN:a,SIMPLE_CLOSE:f,BLOCK_HEAD_CLOSE:l,BLOCK_FOOTER:c,SIGNIFIER:h,COMMENT_CLOSE:p,RAW_CLOSE:d,PIPE:v,AT:m,STRING_LITERAL:g,SINGLE_QUOTE:y,DOUBLE_QUOTE:b,OPERATOR:w,GENERAL:E,WHITESPACE:S,TILDE:x,process:s,Token:r}}(this,this.grips),function(t,n){function r(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function i(e,t){function i(e){if(e.type===n.tokenizer.OPEN)l=new r({parent:null,type:null,token:e,def:[],children:[],complete:!1}),d?(l.parent=d,d.children.push(l)):(delete l.parent,p.push(l)),d=l,V.state=y;else if(e.type===n.tokenizer.GENERAL)l=new r({parent:null,type:x,token:e,val:e.val,complete:!0}),d?(l.parent=d,d.children.push(l)):(delete l.parent,p.push(l));else if(d&&e.type===n.tokenizer.WHITESPACE)l=new r({parent:d,type:x,token:e,val:e.val,complete:!0}),d.children.push(l);else if(e.type===n.tokenizer.BLOCK_FOOTER){if(!d||d.close_header!==n.tokenizer.BLOCK_HEAD_CLOSE)return V.state=S,$;d.complete=!0,d=d.parent}}function s(e){function i(){if(d.type===k||d.type===C||d.type===L){l=new r({parent:d,type:null,token:null,def:[]});if(!d.main_expr&&d.type===L)d.main_expr=l,l.type=_;else if(d.type===k||d.type===C){if(!!d.main_expr)return V.state=S,$;d.main_expr=l,l.type=_,d.type===C&&(l.collection_id=t)}else l.type=D;d.def.push(l),d=l}}if(e.type===n.tokenizer.SIGNIFIER){if(!d||d.type!=null)return V.state=S,$;e.val.match(/^(?:\:|define)$/)?d.type=N:e.val.match(/^(?:\+|extend)$/)?d.type=T:e.val.match(/^(?:\=|insert|print)$/)?d.type=k:e.val.match(/^partial$/)?d.type=C:e.val.match(/^(?:\*|loop)$/)?d.type=L:e.val.match(/^(?:\%|raw)$/)?d.type=A:e.val.match(/^(?:\/|comment)$/)?d.type=O:e.val.match(/^(?:escape|(?:~|escape\s+)[hsuHSU]*)$/)&&(d.type=X),d.type===T||d.type===k?(d.close_header=n.tokenizer.SIMPLE_CLOSE,delete d.children):d.type===C?d.close_header=n.tokenizer.SIMPLE_CLOSE:d.type===N||d.type===L?d.close_header=n.tokenizer.BLOCK_HEAD_CLOSE:d.type===X?(d.close_header=n.tokenizer.BLOCK_HEAD_CLOSE,d.escapes={},e.val.match(/(?:~.*|escape\s+.*)h/i)&&(d.escapes.html=!0),e.val.match(/(?:~.*|escape\s+.*)s/i)&&(d.escapes.string=!0),e.val.match(/(?:~.*|escape\s+.*)u/i)&&(d.escapes.url=!0),e.val.match(/\b[hsu]$/i)||(d.escapes.string=!0),delete d.def):d.type===A?(d.val="",V.state=b,delete d.def,delete d.children):d.type===O&&(d.val="",V.state=w,delete d.def,delete d.children);if(!d.parent&&d.type!==T&&d.type!==N&&d.type!==O||d.parent&&(d.type===T||d.type===N))return V.state=S,$}else if(e.type===n.tokenizer.WHITESPACE){if(d){if(d.type!==T&&d.type!==N&&d.type!==C&&d.type!==k&&d.type!==L&&d.type!==X&&d.type!==D&&d.type!==_)return V.state=S,$;d.def&&d.def.length>0&&d.def.push(new r({parent:d,type:U,token:e}))}}else if(e.type===n.tokenizer.AT){if(!d||d.type!==k||d.def.length!==0)return V.state=S,$;d.type=C}else if(e.type===n.tokenizer.TILDE){if(!d||d.type!==C&&d.type!==k||d.def.length!==0)return V.state=S,$;d.escapes={},e.val.match(/h/i)&&(d.escapes.html=!0),e.val.match(/s/i)&&(d.escapes.string=!0),e.val.match(/u/i)&&(d.escapes.url=!0),e.val.match(/[hsu]/i)||(d.escapes.string=!0)}else if(e.type===n.tokenizer.SINGLE_QUOTE||e.type===n.tokenizer.DOUBLE_QUOTE){if(!d||d.type!==T&&d.type!==N&&d.type!==C&&d.type!==D&&d.type!==_)return V.state=S,$;V.state=E,l=new r({parent:d,type:null,token:e,val:"",delimiter:e.val});if(d.type===N||d.type===T){if(!!d.id)return V.state=S,$;d.id=l,l.type=M,d.type===N&&(l.collection_id=t)}else if(d.type===C){if(!!d.main_expr)return V.state=S,$;d.main_expr=l,l.type=M,l.collection_id=t}else l.type=I;d.def.push(l),d=l}else if(e.type===n.tokenizer.OPERATOR){if(!d)return V.state=S,$;e.val.match(/[\(\[]/)&&i();if(d.type!==D&&d.type!==_)return V.state=S,$;d.token||(d.token=e);if(e.val==="-"&&d.def.length>0&&d.def[d.def.length-1].type!==U&&(d.def[d.def.length-1].type!==z||!d.def[d.def.length-1].val.match(/(?:\.\.)|\[/)))return $;d.def.push(new r({parent:d,type:z,token:e,val:e.val}))}else if(e.type===n.tokenizer.PIPE){if(!d)return V.state=S,$;if(d.type===D||d.type===_){if(d.def.length===0)return V.state=S,$;d=d.parent}if(!d.id&&(d.type===N||d.type===T))return V.state=S,$;if(!(d.type===N||d.type===L||d.type===C&&!d.context_expr))return V.state=S,$;l=new r({parent:d,type:D,token:null,def:[]}),d.type===C&&(d.context_expr=l),d.def.push(l),d=l}else if(e.type===n.tokenizer.SIMPLE_CLOSE){if(!d)return V.state=S,$;if(d.type===D||d.type===_)d=d.parent;if(!d.id&&d.type===T)return V.state=S,$;if(d.close_header!==n.tokenizer.SIMPLE_CLOSE)return V.state=S,$;d.type===C&&!d.context_expr&&(l=new r({parent:d,type:D,token:null,def:[]}),l.def.push(new r({parent:l,type:x,token:null,val:"$"})),d.context_expr=l,d.def.push(l)),d.complete=!0,V.state=g,d=d.parent}else if(e.type===n.tokenizer.BLOCK_HEAD_CLOSE){if(!d)return V.state=S,$;if(d.type===D||d.type===_)d=d.parent;if(!d.id&&d.type===N)return V.state=S,$;if(d.close_header!==n.tokenizer.BLOCK_HEAD_CLOSE)return V.state=S,$;V.state=g}else if(e.type===n.tokenizer.GENERAL){if(!d)return V.state=S,$;i();if(d.type!==D&&d.type!==_)return V.state=S,$;d.token||(d.token=e),e.val.match(/^\d+$/)&&d.def.length>0&&d.def[d.def.length-1].type===z&&d.def[d.def.length-1].val==="-"?d.def[d.def.length-1]=new r({parent:d,type:x,token:new n.tokenizer.Token({type:n.tokenizer.GENERAL,val:"-"+e.val}),val:"-"+e.val}):d.def.push(new r({parent:d,type:x,token:e,val:e.val}))}}function o(e){if(e.type===n.tokenizer.GENERAL)d.token.type!==n.tokenizer.GENERAL&&(d.token=e),d.val+=e.val;else{if(e.type!==n.tokenizer.RAW_CLOSE)return $;d.complete=!0,d=d.parent,V.state=g}}function u(e){e.type===n.tokenizer.COMMENT_CLOSE&&(d=d.parent,d?d.children.pop():p.pop(),V.state=g)}function a(e){if(e.type===n.tokenizer.GENERAL)d.token.type!==n.tokenizer.GENERAL&&(d.token=e),d.val+=e.val;else{if(e.type!==n.tokenizer.SINGLE_QUOTE&&e.type!==n.tokenizer.DOUBLE_QUOTE||d.delimiter!==e.val)return $;d=d.parent,V.state=y}}var f,l,c,h=[i,s,o,u,a];t!==v&&(v&&p.push(new r({type:W,close:v,complete:!0})),v=t,p.push(new r({type:W,start:t,complete:!0})));for(f=0;f<e.length;f++){if(V.state===S)return $;c=h[V.state](e[f]);if(c)return c}return!0}function s(){v&&p.push(new r({type:W,close:v,complete:!0})),v=null}function o(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===x){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==x){n--;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].token.val+=e[i].token.val,e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return u(e)}function u(e){var t,n,r,i;for(r=0;r<e.length;r++)if(e[r].type===U){t=n=r;for(i=t+1;i<e.length;i++){n=i;if(e[i].type!==U){n--;break}}if(n>t){for(i=t+1;i<=n;i++)e[t].token.val+=e[i].token.val,e[t].val+=e[i].val;e.splice(t+1,n-t)}else r=i}return e}function a(e){var t=[],n=0,r=e.length-1;while(n<=r){e[n].type===U&&n++,e[r].type===U&&r--;if(!(n<r)||e[n].type!==U&&e[r].type!==U)break}return n<=r&&(t=e.slice(n,r+1)),t}function f(e){var t=[],n=0,r=e.length-1,i,s=0;while(n<r){e[n].type===U&&n++,e[r].type===U&&r--;if(n<r&&e[n].type!==U&&e[r].type!==U){if(e[n].type!==z||e[n].val!=="("||e[r].type!==z||e[r].val!==")")break;for(i=n+1;i<r;i++)if(e[i].type===z){e[i].val==="("?s++:e[i].val===")"&&s--;if(s<0)break}if(s!==0)break;n++,r--}}return n<=r&&(t=e.slice(n,r+1)),t}function l(e){for(var t=0;t<e.length;t++)e[t].type===z&&(e.splice(t,1),t--)}function c(e){function t(e){var t,n,r=[],i=!1;if(e.length<5)return!1;if(e[0].type!==z||e[0].val!=="[")return!1;r.push(e[0]);for(t=1;t<e.length;t++){n=e[t];if(n.type===U)continue;r.push(n);if(n.type===z){if(n.val==="]")break;if(!n.val.match(/(?:\.\.)|[\-,]/))return!1;n.val.match(/(?:\.\.)|,/)&&(i=!0)}}return r.length<5||!i?!1:r}function i(e){function t(e,t,n){var i,s;e=f(e),i=new r({parent:u,type:t,token:e[0].token,def:e}),E=n(i);if(E)return E;for(s=0;s<i.def.length;s++)i.def[s].parent=i;return i}var n,i,s=[],o,u,a,l,c;if(e.length>0){for(n=0;n<e.length;n++){i=e[n];if(i.type===z&&i.val.match(/[?:]/)){if(i.val==="?"){if(!!u)return!1;u=new r({parent:null,type:j,token:e[0].token,def:[]}),a=t(s,F,h);if(a instanceof Error)throw a;c=new r({parent:u,type:B,token:null,def:[]}),o=new r({parent:c,type:I,token:null,val:"",delimiter:'"'}),c.def.push(o),s=[]}else if(i.val===":"){if(!u||!!l)return!1;l=t(s,B,m);if(l instanceof Error)throw l;s=[]}}else s.push(i)}if(s.length>0){if(!u)return!1;if(!l){l=t(s,B,m);if(l instanceof Error)throw l}else{c=t(s,B,m);if(c instanceof Error)throw c}s=[]}if(a&&l)return u.def.push(a,l,c),u}}function s(e){var t;if((t=e.val.match(/#/g))&&t.length>1)return $;if(e.parent.type===N){if(!e.val)return $;if(t=e.val.match(/(#.*?)([^a-z0-9_\-$.]).*$/i))return $;if(!e.val.match(/^#/))return $;e.val=e.collection_id+e.val}else if(e.parent.type===T){if(t=e.val.match(/#/))return $}else if(e.parent.type===C){if(!e.val||!e.val.match(/#.+/))return $;if(t=e.val.match(/(#.*?)([^a-z0-9_\-$.]).*$/i))return $}}function h(e){function t(e){while(e.parent&&(e=e.parent))if(e.type===n.parser.TAG_LOOP)return!0;return!1}function r(e){while(e.parent&&(e=e.parent))if(e.type===n.parser.MAIN_REF_EXPR||e.type===n.parser.ASSIGNMENT_EXPR)return e.type===n.parser.MAIN_REF_EXPR;return!1}var i,s,o,u,a=[];if(!(e.def&&e.def.length>0))return $;for(i=0;i<e.def.length;i++){if(e.def[i].type===U)continue;o=u,u=e.def[i];if(u.type===z){if(!u.val.match(/[.!\[\]\(\)]/))return $;if(o)if(o.type===z){if(u.val==="("&&!o.val.match(/[!\(\[]/))return $;if(u.val==="!"&&!o.val.match(/[!\(]/))return $;if(u.val.match(/[.\[\]\)]/)&&!o.val.match(/[\]\)]/))return $}else{if(o.type===x&&!u.val.match(/[.\[\]\)]/))return $;if(o.type===I&&!u.val.match(/[\]\)]/))return $}else if(!u.val.match(/[!\(]/))return $;if(u.val.match(/[\[\(]/))a.push(u.val);else if(u.val.match(/[\]\)]/)){if(!(a.length>0&&(a[a.length-1]==="["&&u.val==="]"||a[a.length-1]==="("&&u.val===")")))return $;a.pop()}}else if(u.type===x){if(u.val.match(/^\d/)){if(!u.val.match(/^\d+$/))return $;if(o&&(o.type!==z||!o.val.match(/[\(\[]/)))return $}s=r(u);if(e.def.length===1&&u.val==="_"&&!s&&u.parent.parent.context_expr!==u.parent)return $;if(u.val==="_"&&!(s&&t(u.parent.parent)||!s&&t(u)))return $;if(o){if(o.type===x)return $;if(o.type===z&&!o.val.match(/[.!\(\[]/))return $}}else if(u.type===I&&o&&(o.type!==z||!o.val.match(/[\[\(]/)))return $}if(a.length>0)return $}function p(e){if(!e.def||e.def.length!==5)return $;if(e.def[1].type!==x||!e.def[1].val.match(/^-?\d+$/))return $;if(e.def[3].type!==x||!e.def[3].val.match(/^-?\d+$/))return $;if(e.def[2].type!==z||e.def[2].val!=="..")return $}function d(e){var t,n,r;if(!(e.def&&e.def.length>=5))return $;for(t=1;t<e.def.length-1;t++){n=r,r=e.def[t];if(r.type===I){if(n&&(n.type!==z||n.val!==","))return $}else{if(r.type!==z||r.val!==",")return $;if(!n||n.type!==I)return $}}if(e.def[e.def.length-2].type!==I)return $}function v(e){var n,s,o,u,c,h,v=[],y,b;if(!(e.def&&e.def.length>0))return $;for(n=0;n<e.def.length;n++){if(e.def[n].type===U)continue;o=u,u=e.def[n];if(!!y){c=f(e.def.slice(n));if(c.length===0)return $;b=new r({parent:e,type:B,token:c[0].token,def:[]}),h=i(c);if(!h){b.def=c,E=m(b);if(E)return E}else b.def=[h];for(s=0;s<b.def.length;s++)b.def[s].parent=b;break}if(u.type===z)if(u.val==="="){y=new r({parent:e,type:H,token:v[0].token,def:v});if(!v[0]||v[0].type!==H||!v[1]||v[1].type!==R&&v[1].type!==q){E=g(y);if(E)return E}for(s=0;s<y.def.length;s++)y.def[s].parent=y;v=[]}else if(u.val==="["){c=t(e.def.slice(n));if(c){h=new r({parent:null,type:H,token:e.def[0].token,def:e.def.slice(0,n)}),E=g(h),E||(v=[h],h=new r({parent:null,type:q,token:u.token,def:c}),E=p(h),E&&(h.type=R,E=d(h)),E?E=$:(v.push(h),n+=c.length-1,l(h.def)));if(E)return E}else v.push(u)}else{if(!o||!u.val.match(/[.\[\]]/))return $;v.push(u)}else v.push(u)}if(!y||!b)return $;y.def=a(y.def),b.def=a(b.def),e.def=[y,b],e.type=P}function m(e){var t,n,r,i=!1;if(!(e.def&&e.def.length>0))return $;for(t=0;t<e.def.length;t++){n=e.def[t];if(n.type===z){if(n.val==="!")return $}else if(n.type===x)if(!n.val.match(/^\d+$/))i=!0;else if(!i)return $}r=h(e);if(r)return r}function g(e){var t,n,r,i;if(!(e.def&&e.def.length>0))return $;for(t=0;t<e.def.length;t++){if(e.def[t].type===U)continue;n=r,r=e.def[t];if(r.type===I&&(!n||n.type!==z||n.val!=="["))return $}i=m(e);if(i)return i}var y,b,w,E,S;if(e.type===T){if(!e.id||!(y=c(e.id)))throw $;e.id=y;if(e.def&&e.def.length){e.def[0]=e.id;if(e.def.length>1){for(S=1;S<e.def.length;S++)if(e.def[S].type!==U)throw $;e.def=[e.id]}}return e}if(e.type===N){if(!e.id||!(y=c(e.id)))throw $;e.id=y;if(e.def&&e.def.length){y=[e.id],w=a(e.def.slice(1));for(S=0;S<w.length;S++)b=c(w[S]),b&&y.push(b);e.def=y}if(e.children&&e.children.length){e.children=o(e.children),y=[];for(S=0;S<e.children.length;S++)b=c(e.children[S]),b&&y.push(b);e.children=o(y)}return e}if(e.type===L){if(!e.main_expr||!(y=c(e.main_expr)))throw $;e.main_expr=y;if(e.def&&e.def.length){y=[e.main_expr],w=a(e.def.slice(1));for(S=0;S<w.length;S++)b=c(w[S]),b&&y.push(b);e.def=y}if(e.children&&e.children.length){e.children=o(e.children),y=[];for(S=0;S<e.children.length;S++)b=c(e.children[S]),b&&y.push(b);e.children=o(y)}return e}if(e.type===k){if(!e.main_expr||!(y=c(e.main_expr)))throw $;e.main_expr=y;if(e.def&&e.def.length){if(e.def.length>1)for(S=1;S<e.def.length;S++)if(e.def[S].type!==U)throw $;e.def=[e.main_expr]}return e}if(e.type===C){if(!e.main_expr||!(y=c(e.main_expr)))throw $;e.main_expr=y,e.context_expr.type=H,e.context_expr.def=a(e.context_expr.def),E=g(e.context_expr);if(E)throw E;return e.def=[e.main_expr,e.context_expr],e}if(e.type===A)return e.type=x,e;if(e.type===M){if(E=s(e))throw E;return e}if(e.type===D){if(!e.def||!e.def.length)throw $;e.def=u(e.def),e.def=a(e.def),E=v(e);if(E)throw E;return e}if(e.type===_){if(!e.def||!e.def.length)throw $;y=[];for(S=0;S<e.def.length;S++)e.def[S].type!==U&&y.push(e.def[S]);e.def=f(y);if((y=t(e.def))&&y.length===e.def.length){y=new r({parent:e,type:null,token:e.token,def:y});for(S=0;S<y.def.length;S++)y.def[S].parent=y;E=p(e),E?(E=d(e),E||(y.type=R)):y.type=q;if(E)throw $;l(y.def),e.def=[y]}else e.parent.type===k||e.parent.type===L?E=g(e):e.parent.type===C&&(E=m(e));if(E)throw E;return e}if(e.type!==x)return e;if(!e.parent&&e.token.type!==n.tokenizer.WHITESPACE)throw $;if(e.val!=="")return e}function h(){var e;while(m<p.length&&!e&&p[m].complete)e=c(p[m++]);return e}var p=[],d,v="",m=0,g=0,y=1,b=2,w=3,E=4,S=5,x=0,T=1,N=2,C=3,k=4,L=5,A=6,O=7,M=8,_=9,D=10,P=11,H=12,B=13,j=14,F=15,I=16,q=17,R=18,U=19,z=20,W=21,X=22,V,$=new Error("Unknown error");V={OUTSIDE:g,INSIDE:y,RAW:b,COMMENT:w,LITERAL:E,INVALID:S,TEXT:x,TAG_EXTEND:T,TAG_DEFINE:N,TAG_INCL_TMPL:C,TAG_INSERT_VAR:k,TAG_LOOP:L,TAG_RAW:A,TAG_COMMENT:O,ID:M,MAIN_REF_EXPR:_,GENERAL_EXPR:D,ASSIGNMENT_EXPR:P,REF_EXPR:H,VAL_EXPR:B,CONDITIONAL_EXPR:j,BOOLEAN_EXPR:F,STRING_LITERAL:I,RANGE_LITERAL:q,SET_LITERAL:R,WHITESPACE:U,OPERATOR:z,COLLECTION_MARKER:W,TAG_ESCAPE:X,state:g,nodify:i,end:s,parseNextNode:h,Node:r},n.parser=V}(this,this.grips),function(t,n){function r(e){return e.replace(/\\([\s\S])|(")/g,"\\$1$2")}function i(e){return e.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}function s(e){return e.replace(/\\(?!\\*\")/g,"\\\\")}function o(e){var t="";return t+="(function(G){",t+="function __sort_fn__(a,b){ return a-b; }",t+="var partial = G.definePartial, clone = G.cloneObj, extend = G.extend, esc = G.strEscapes,",t+='unerr = new Error("Unknown error"),',t+="RLH = G.RangeLiteralHash,",t+='cID = "'+e.start+'";',t}function u(){return"})(grips||this.grips);"}function a(e){return h(e.def[0])+" ? "+h(e.def[1])+" : "+h(e.def[2])}function f(e){return e.delimiter+e.val+e.delimiter}function l(e){var t="";return t+="for (i="+e.def[0].val+"; i",e.def[0].val<=e.def[1].val?t+="<="+e.def[1].val+"; i++) {":t+=">="+e.def[1].val+"; i--) {",t}function c(e){var t,n="",r,i;i="";for(t=0;t<e.def.length;t++)r=e.def[t],i+=(i!==""?",":"")+f(r);return n+="var _set = ["+i+"];",n+="for (i=0; i<"+e.def.length+"; i++) {",n}function h(e){var t,r="",i,s;if(e.type===n.parser.STRING_LITERAL||e.type===n.parser.ID)r+=f(e);else{if(!(e.def&&e.def.length>0))throw N;if(e.def[0].type===n.parser.CONDITIONAL_EXPR)r+=a(e.def[0]);else for(t=0;t<e.def.length;t++)s=i,i=e.def[t],i.type===n.parser.TEXT?(i.val.match(/^\d+$/)||i.val.match(/^[_\$](?=(?:[^a-z0-9_$]|$))/i)||s&&s.type===n.parser.OPERATOR&&s.val==="."||(r+="$$."),r+=i.val):i.type===n.parser.OPERATOR?r+=i.val:i.type===n.parser.STRING_LITERAL&&(r+=f(i))}return r}function p(e){var t="",n,r;return n=e.def[0],r=h(n.def[0]),t+=r+" = new RLH();",t+=l(n.def[1]),n=e.def[1].def[0],t+=r+'["" + i] = ('+h(n.def[0])+" === i) ? ",t+=h(n.def[1])+" : "+h(n.def[2])+";",t+="}",t}function d(e){var t="",n,r;return n=e.def[0],r=h(n.def[0]),t+=r+" = {};",t+=c(n.def[1]),n=e.def[1].def[0],t+=r+"[_set[i]] = ("+h(n.def[0])+" === _set[i]) ? ",t+=h(n.def[1])+" : "+h(n.def[2])+";",t+="}",t}function v(e){var t="",r;return r=e.def[0],r.def[r.def.length-1].type===n.parser.RANGE_LITERAL?t+=p(e):r.def[r.def.length-1].type===n.parser.SET_LITERAL?t+=d(e):(t+=h(r),t+=" =",t+=h(e.def[1]),t+=";"),t}function m(e){return'extend(cID,"'+e.id.val+'");'}function g(e){var t,n="",r;n+="partial(function($,$$){",n+="$ = clone($) || {};",n+="$$ = clone($$) || {};",n+='var i, ret = "", ret2, _;';for(t=1;t<e.def.length;t++)r=e.def[t],n+=v(r);return n+=S(e),n+="return ret;",n+='},"'+e.id.val+'"',n+=");",n}function y(e){var t="";return t+="ret2 = esc((function(){",t+='var ret = "", ret2;',t+=S(e),t+="return ret;",t+="})(),"+JSON.stringify(e.escapes)+");",t+=x("ret","ret2"),t}function b(e){var t,r="",i;r+="ret2 = (function($,$$,_){",r+="function __iter__($,$$,value,key,index){",r+='var i, ret = "", ret2, _;',r+="if (value == null) return ret;",r+="$ = clone($);",r+="$$ = clone($$);",r+="_ = {",r+="value: value,",r+="key: key,",r+="index: index,",r+="even: (index % 2) === 0,",r+="odd: (index % 2) === 1,",r+="first: (index === 0),",r+="last: (index === len - 1)",r+="};";for(t=1;t<e.def.length;t++)i=e.def[t],r+=v(i);return r+=S(e),r+="return ret;",r+="}",r+='var i, j = 0, len, ret = "", it, tmp;',e.main_expr.def[0].type===n.parser.SET_LITERAL?(r+=c(e.main_expr.def[0]),r+="len = _set.length;",r+='ret2 = __iter__($,$$,_set[i],""+i,i);',r+=x("ret","ret2"),r+="}"):e.main_expr.def[0].type===n.parser.RANGE_LITERAL?(r+="len = "+(Math.abs(e.main_expr.def[0].def[0].val-e.main_expr.def[0].def[1].val)+1)+";",r+=l(e.main_expr.def[0]),r+='ret2 = __iter__($,$$,i,""+i,j++);',r+=x("ret","ret2"),r+="}"):(r+="it = "+h(e.main_expr)+";",r+="if (it == null) {",r+='return "";',r+="}",r+='if (Object.prototype.toString.call(it) === "[object Array]") {',r+="len = it.length;",r+="for (i=0; i<len; i++) {",r+='ret2 = __iter__($,$$,it[i],""+i,i);',r+=x("ret","ret2"),r+="}",r+='} else if (typeof it === "object") {',r+="tmp = Object.keys(it);",r+="len = tmp.length;",r+="if (it instanceof RLH) {",r+="tmp.sort(__sort_fn__);",r+="for (i=0; i<len; i++) {",r+="ret2 = __iter__($,$$,it[tmp[i]],tmp[i],i);",r+=x("ret","ret2"),r+="}",r+="} else {",r+="for (i in it) { if (it.hasOwnProperty(i)) {",r+="ret2 = __iter__($,$$,it[i],i,j++);",r+=x("ret","ret2"),r+="}}",r+="}",r+="} else {",r+="return ",r+="unerr;",r+="}"),r+="return ret;",r+="})(clone($),clone($$),clone(_));",r+=x("ret","ret2"),r}function w(e){var t="",n;return n=h(e.context_expr),t+="ret2 = "+n+";",t+="ret2 = G.render("+h(e.main_expr)+",ret2,$$);",e.escapes&&(t+="ret2 = esc(ret2,"+JSON.stringify(e.escapes)+");"),t+=x("ret","ret2"),t}function E(e){var t="",n=h(e.main_expr);return e.escapes?t+="ret += esc("+n+","+JSON.stringify(e.escapes)+");":t+="ret += "+n+";",t}function S(e){var t,o="",u;for(t=0;t<e.children.length;t++)u=e.children[t],u.type===n.parser.TEXT?o+='ret += "'+i(s(r(u.val)))+'";':u.type===n.parser.TAG_LOOP?o+=b(u):u.type===n.parser.TAG_INCL_TMPL?o+=w(u):u.type===n.parser.TAG_INSERT_VAR?o+=E(u):u.type===n.parser.TAG_ESCAPE&&(o+=y(u));return o}function x(e,t){var n="";return n+=e+" += "+t+";",n}function T(e){var t,r=[],i="",s="",a;while(t=n.parser.parseNextNode()){r.push(t);if(t.type===n.parser.COLLECTION_MARKER)t.start?(a=o(t),i+=a,s+=a):t.close&&(a=u(t),i+=a,s+=a,e&&n.initializeCollection(t.close,i),i="");else if(t.type===n.parser.TAG_EXTEND){if(!(r.length>1&&r[r.length-2].type===n.parser.COLLECTION_MARKER))throw N;a=m(t),i+=a,s+=a}else{if(t.type!==n.parser.TAG_DEFINE)throw N;a=g(t),i+=a,s+=a}}return s}var N=new Error("Unknown error");n.generator={process:T}}(this,this.grips);